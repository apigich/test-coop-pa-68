<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>S-MAP Chiang Mai (Smart Movement & Awareness Platform)</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    * { box-sizing: border-box; }
    body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; overflow-x: hidden; }
    
    #globalLoader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #ffffff; z-index: 9999; display: flex; flex-direction: column; justify-content: center; align-items: center; transition: opacity 0.3s ease; }
    .loader-content { text-align: center; }
    .loader-spinner { width: 60px; height: 60px; margin: 0 auto 20px; border: 6px solid #f3f3f3; border-top: 6px solid #0d6efd; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

    .main-header { background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Doi_Suthep_02.jpg/1200px-Doi_Suthep_02.jpg') center center/cover no-repeat; color: white; position: relative; padding: 0; height: auto; min-height: 250px; display: flex; align-items: center; }
    .header-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, rgba(13, 110, 253, 0.92) 0%, rgba(0, 50, 133, 0.85) 100%); z-index: 1; }
    .header-content { position: relative; z-index: 2; width: 100%; padding: 40px; display: flex; align-items: center; justify-content: center; }
    .header-icon-box { margin-right: 30px; }
    .org-title-group { display: flex; flex-direction: column; justify-content: center; }
    .org-top-text { font-weight: 400; font-size: 1.4rem; letter-spacing: 1px; color: #ffeb3b; margin-bottom: 5px; text-transform: uppercase; text-shadow: 0 2px 4px rgba(0,0,0,0.5); }
    .org-main-text { font-weight: 700; line-height: 1.3; text-shadow: 0 4px 10px rgba(0,0,0,0.3); font-size: 2.2rem; }
    .eng-subtitle { font-weight: 300; opacity: 0.9; font-size: 1rem; margin-top: 5px; letter-spacing: 0.5px; }

    @media (max-width: 992px) { 
      .main-header { min-height: auto; }
      .header-content { flex-direction: column; text-align: center; padding: 70px 20px 40px 20px; gap: 15px; }
      .header-icon-box { margin-right: 0 !important; margin-bottom: 10px; }
      .org-top-text { font-size: 1.1rem; }
      .org-main-text { font-size: 1.5rem; line-height: 1.4; }
      .eng-subtitle { font-size: 0.85rem; margin-top: 5px; display: block; }
      .sidebar-toggle-btn { top: 20px !important; left: 20px !important; background-color: transparent !important; border: 2px solid rgba(255,255,255,0.7) !important; box-shadow: none !important; }
    }
    
    .wrapper { display: flex; width: 100%; align-items: flex-start; }
    .sidebar { min-width: 260px; max-width: 260px; background: white; border-right: 1px solid #e9ecef; transition: all 0.3s; position: sticky; top: 0; height: 100vh; overflow-y: auto; z-index: 1000; display: flex; flex-direction: column; flex-shrink: 0; }
    @media (max-width: 992px) { .sidebar { position: fixed; left: 0; top: 0; margin-left: -260px; box-shadow: 4px 0 10px rgba(0,0,0,0.1); } .sidebar.active { margin-left: 0; } .overlay { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.5); z-index: 998; opacity: 0; transition: all 0.3s; } .overlay.active { display: block; opacity: 1; } }
    .sidebar-toggle-btn { position: absolute; z-index: 1001; color: white; border-radius: 8px; cursor: pointer; padding: 5px 10px; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; }
    .nav-link-main { padding: 15px 25px; color: #0d6efd; font-weight: 700; cursor: pointer; display: block; text-decoration: none; border-bottom: 1px solid #f8f9fa; transition: 0.2s; font-size: 1rem; }
    .nav-link-main:hover { background-color: #f1f8ff; color: #0a58ca; padding-left: 30px; }
    .nav-link-main.active { background-color: #e7f1ff; border-left: 5px solid #0d6efd; color: #0d6efd; }
    .nav-link-sub { padding: 10px 25px 10px 50px; color: #6c757d; cursor: pointer; display: block; text-decoration: none; font-size: 0.9rem; transition: 0.2s; }
    .nav-link-sub:hover { color: #0d6efd; background-color: #f8f9fa; transform: translateX(5px); }
    
    .main-content { width: 100%; padding: 20px; min-height: 100vh; background-color: #f0f2f5; flex-grow: 1; }
    .content-section { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 25px; border: 1px solid #fff; }
    .section-header { padding-bottom: 10px; margin-bottom: 20px; color: #0d6efd; font-weight: 700; font-size: 1.4rem; border-bottom: 2px solid #f0f0f0; }
    
    .carousel-item { background-color: #e9ecef; height: 500px; }
    .carousel-item img { width: auto !important; height: 100% !important; max-width: 100%; margin: 0 auto; display: block; object-fit: contain; }
    @media (max-width: 768px) { .carousel-item { height: 400px; } }

    .main-footer { background-color: #1a1d20; color: #cfd2d6; padding: 60px 40px; margin-top: auto; border-top: 5px solid #0d6efd; }
    .footer-title { color: white; font-weight: 700; margin-bottom: 20px; border-left: 4px solid #0d6efd; padding-left: 10px; }
    .admin-link-container { margin-top: 20px; padding-top: 10px; border-top: 1px solid rgba(255,255,255,0.1); }
    .admin-trigger { color: #6c757d; font-size: 0.8rem; text-decoration: none; transition: 0.3s; cursor: pointer; display: inline-block;}
    .admin-trigger:hover { color: #adb5bd; text-decoration: underline; }

    .banner-btn { display: flex; align-items: center; justify-content: flex-start; padding: 20px; margin-bottom: 20px; border-radius: 15px; color: white; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; overflow: hidden; border: none; width: 100%; text-align: left; background-size: cover !important; background-position: center !important; }
    .banner-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); color: white; }
    .banner-icon { flex: 0 0 100px; width: 100px; height: 100px; border-radius: 50%; font-size: 4rem; background: rgba(255,255,255,0.25); display: flex; align-items: center; justify-content: center; margin-right: 20px; box-shadow: 0 4px 8px rgba(0,0,0,0.1); }
    .banner-text { flex-grow: 1; position: relative; z-index: 2; overflow: hidden; }
    .banner-title { font-weight: 800; font-size: clamp(1.2rem, 2vw, 1.6rem); margin-bottom: 5px; line-height: 1.2; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
    .banner-desc { font-size: 1rem; opacity: 0.95; font-weight: 400; text-shadow: 0 1px 2px rgba(0,0,0,0.2); }
    .status-badge { font-size: 0.85rem; padding: 4px 10px; border-radius: 20px; font-weight: bold; background: white; color: #d63031; display: inline-block; margin-right: 5px; margin-top: 5px; }
    .date-badge { font-size: 0.85rem; padding: 4px 10px; border-radius: 20px; background: rgba(0,0,0,0.3); color: white; border: 1px solid rgba(255,255,255,0.5); display: inline-block; margin-top: 5px; }
    .banner-btn.closed { filter: grayscale(100%); opacity: 0.7; background: #636e72 !important; cursor: not-allowed; pointer-events: none; }
    
    /* ‡∏Ñ‡∏•‡∏≤‡∏™‡∏õ‡πâ‡∏≤‡∏¢ NEW ‡∏Ç‡∏≠‡∏á‡πÅ‡∏ö‡∏ô‡πÄ‡∏ô‡∏≠‡∏£‡πå (‡∏Ñ‡∏á‡πÑ‡∏ß‡πâ‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏¥‡∏°) */
    .new-badge { position: absolute; top: 0; left: 0; background: #ff0000; color: white; font-size: 0.75rem; font-weight: bold; padding: 5px 15px; border-bottom-right-radius: 10px; z-index: 10; display: none; }
    
    .bg-gradient-pink { background: linear-gradient(135deg, #ff7eb3 0%, #ff758c 100%); }
    .bg-gradient-yellow { background: linear-gradient(135deg, #fce38a 0%, #f38181 100%); color: #4a4a4a !important; }
    
    .admin-controls { display: none; background: #fff3cd; border: 1px solid #ffeeba; padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    .pagination-container { display: flex; justify-content: center; gap: 5px; margin-top: 20px; }
    .page-btn { border: 1px solid #dee2e6; background: white; color: #0d6efd; padding: 5px 12px; cursor: pointer; border-radius: 5px; }
    .page-btn.active { background: #0d6efd; color: white; border-color: #0d6efd; }
    .page-btn.disabled { opacity: 0.5; cursor: not-allowed; }
    
    .chat-container { height: 400px; overflow-y: auto; border: 1px solid #eee; background: #f8f9fa; padding: 15px; border-radius: 10px; display: flex; flex-direction: column; gap: 10px; }
    .chat-msg { max-width: 80%; padding: 10px 15px; border-radius: 15px; font-size: 0.95rem; line-height: 1.5; word-wrap: break-word; }
    .chat-user { align-self: flex-end; background-color: #0d6efd; color: white; border-bottom-right-radius: 2px; }
    .chat-ai { align-self: flex-start; background-color: white; color: #333; border: 1px solid #e0e0e0; border-bottom-left-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); }
    .chat-ai strong { color: #0d6efd; }
    .typing-indicator span { display: inline-block; width: 6px; height: 6px; background-color: #888; border-radius: 50%; animation: blink 1.4s infinite both; margin: 0 2px; }
    .typing-indicator span:nth-child(2) { animation-delay: 0.2s; } .typing-indicator span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes blink { 0% { opacity: 0.2; } 20% { opacity: 1; } 100% { opacity: 0.2; } }

    /* üü¢ CSS ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢‡∏Å‡∏≥‡∏Å‡∏±‡∏ö‡∏Ç‡∏≠‡∏á‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (NEW ‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà) üü¢ */
    .badge-pin { background-color: #34495e; color: white; }
    .badge-custom-new { 
        display: inline-block;
        background-color: transparent; 
        color: #FFD700; /* ‡∏™‡∏µ‡∏ó‡∏≠‡∏á */
        -webkit-text-stroke: 0.5px #FF8C00; /* ‡∏Ç‡∏≠‡∏ö‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á/‡∏™‡πâ‡∏° */
        text-shadow: 1px 1px 0px #FFD700, -1px -1px 0px #FFD700, 1px -1px 0px #FFD700, -1px 1px 0px #FFD700; 
        font-weight: 900; 
        font-size: 0.75rem;
        letter-spacing: 0.5px;
        padding: 3px 10px;
        border-radius: 20px;
        border: 2px solid #ff0000; /* ‡∏Å‡∏£‡∏≠‡∏ö‡∏™‡∏µ‡πÅ‡∏î‡∏á */
        animation: pulse-red-border 1.2s infinite; 
    }
    @keyframes pulse-red-border { 
        0% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0.7); } 
        70% { box-shadow: 0 0 0 6px rgba(255, 0, 0, 0); } 
        100% { box-shadow: 0 0 0 0 rgba(255, 0, 0, 0); } 
    }
  </style>
</head>
<body onload="initSystem()">

  <div id="fb-root"></div>
  <script async defer crossorigin="anonymous" src="https://connect.facebook.net/th_TH/sdk.js#xfbml=1&version=v18.0"></script>

  <div id="globalLoader">
    <div class="loader-content">
      <div class="loader-spinner"></div>
      <h5 class="text-primary fw-bold">‡πÅ‡∏û‡∏•‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏° S-Map Chiang Mai</h5>
      <div class="text-muted small">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î...</div>
    </div>
  </div>

  <script>
    // ** ‡πÉ‡∏™‡πà Web App URL ‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà **
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGWDn2t6cPkNDJyuYN_RXvBfB_m7MM1gdHs4-QVKLhRWOhkDjbxeOQxoAc3ZKoJaZFEg/exec"; 
  </script>

  <header class="main-header container-fluid">
    <div class="header-overlay"></div>
    <div class="header-content">
      <button class="sidebar-toggle-btn d-lg-none me-3" onclick="toggleSidebar()"><i class="material-icons">menu</i></button>
      <div class="header-icon-box d-none d-lg-block"><i class="material-icons" style="font-size: 5.5rem;">account_balance</i></div> 
      <div class="header-icon-box d-block d-lg-none"><i class="material-icons" style="font-size: 4.5rem;">account_balance</i></div> 
      <div class="org-title-group">
        <div class="org-top-text">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</div>
        <h1 class="m-0 org-main-text">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h1>
        <div class="eng-subtitle">Strategy and Information for Provincial Development</div>
      </div>
    </div>
  </header>

  <div class="wrapper">
    <div class="overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <nav class="sidebar" id="sidebar">
      <div class="flex-grow-1 pt-4">
        <h6 class="px-3 text-secondary fw-bold mt-2 mb-3" style="font-size: 0.85rem; letter-spacing: 1px;">MENU</h6>
        <a class="nav-link-main active" id="menu-home" onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
        <div id="sub-home" class="mb-2">
          <a class="nav-link-sub" onclick="scrollToId('sec-feedback')">‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</a>
          <a class="nav-link-sub" onclick="scrollToId('sec-dash')">üìçDashboard</a>
          <a class="nav-link-sub" onclick="scrollToId('sec-pr')">‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</a>
          <a class="nav-link-sub" onclick="scrollToId('sec-facebook')">‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</a>
        </div>
        <a class="nav-link-main" id="menu-docs" onclick="showPage('docs')">üìÇ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
        <a class="nav-link-main" id="menu-calendar" onclick="showPage('calendar')">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</a>
        <a class="nav-link-main" id="menu-qa" onclick="showPage('qa')">‚ùì ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö (Q&A)</a>
      </div>
      
      <div id="sidebarLogoutArea" class="px-3 mb-4 mt-auto" style="display:none;">
         <button class="btn btn-danger w-100 fw-bold" onclick="logoutSystem()">
           <i class="material-icons align-middle fs-6 me-2">logout</i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö
         </button>
      </div>
    </nav>

    <div class="main-content">
      <div id="page-home">
        
        <div id="section-video" class="content-section text-center">
          <h3 class="section-header">üì∫ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
          <div class="ratio ratio-16x9 w-100 w-md-75 mx-auto shadow rounded overflow-hidden" style="max-width: 800px;">
            <iframe id="main_video_frame" src="" allowfullscreen></iframe>
          </div>
        </div>

        <div id="adminHomePanel" class="content-section bg-warning-subtle border-warning" style="display:none;">
          <div class="d-flex justify-content-between align-items-center mb-3">
             <h5 class="fw-bold text-dark m-0"><i class="material-icons align-middle">admin_panel_settings</i> ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å (Admin)</h5>
          </div>
          <hr class="border-secondary opacity-25">
          <div class="row">
            <div class="col-md-6 mb-3">
               <div class="bg-white p-3 rounded shadow-sm h-100 border-start border-4 border-danger">
                  <h6 class="fw-bold text-danger mb-3">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤: ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà 1 (‡∏™‡∏µ‡∏ä‡∏°‡∏û‡∏π)</h6>
                  <div class="mb-2"><label class="small text-muted">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label><input type="text" id="admin_title_1" class="form-control form-control-sm"></div>
                  <div class="mb-2"><label class="small text-muted">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Subtitle):</label><input type="text" id="admin_subtitle_1" class="form-control form-control-sm"></div>
                  <div class="mb-3"><label class="small text-muted">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label><input type="text" id="admin_date_1" class="form-control form-control-sm"></div>
                  <div class="form-check form-switch d-flex justify-content-between align-items-center bg-light p-2 rounded">
                    <label class="form-check-label fw-bold" for="swForm1">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö</label>
                    <input class="form-check-input fs-5" type="checkbox" id="swForm1">
                  </div>
                  <button class="btn btn-sm btn-outline-danger w-100 mt-3" onclick="saveFormConfig(1)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏° 1</button>
               </div>
            </div>
            <div class="col-md-6 mb-3">
               <div class="bg-white p-3 rounded shadow-sm h-100 border-start border-4 border-warning">
                  <h6 class="fw-bold text-warning text-dark mb-3">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤: ‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ó‡∏µ‡πà 2 (‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)</h6>
                  <div class="mb-2"><label class="small text-muted">‡∏ä‡∏∑‡πà‡∏≠‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠:</label><input type="text" id="admin_title_2" class="form-control form-control-sm"></div>
                  <div class="mb-2"><label class="small text-muted">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢ (Subtitle):</label><input type="text" id="admin_subtitle_2" class="form-control form-control-sm"></div>
                  <div class="mb-3"><label class="small text-muted">‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà:</label><input type="text" id="admin_date_2" class="form-control form-control-sm"></div>
                  <div class="form-check form-switch d-flex justify-content-between align-items-center bg-light p-2 rounded">
                    <label class="form-check-label fw-bold" for="swForm2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö</label>
                    <input class="form-check-input fs-5" type="checkbox" id="swForm2">
                  </div>
                  <button class="btn btn-sm btn-outline-warning text-dark w-100 mt-3" onclick="saveFormConfig(2)">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ü‡∏≠‡∏£‡πå‡∏° 2</button>
               </div>
            </div>
          </div>
          <div class="mt-3 bg-white p-3 rounded shadow-sm border-start border-4 border-primary">
             <h6 class="fw-bold text-primary mb-3">‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ (General Config)</h6>
             <div class="mb-2">
               <label class="small text-muted">‡∏•‡∏¥‡∏á‡∏Å‡πå YouTube (Video URL):</label>
               <input type="text" id="admin_video_url" class="form-control form-control-sm" placeholder="https://www.youtube.com/watch?v=...">
             </div>
             <div class="mb-2">
               <label class="small text-muted">‡∏•‡∏¥‡∏á‡∏Å‡πå Dashboard (Dashboard URL):</label>
               <input type="text" id="admin_dash_url" class="form-control form-control-sm" placeholder="URL ‡∏Ç‡∏≠‡∏á Dashboard (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
             </div>
             
             <div class="mb-2 pt-2 border-top mt-3">
                 <div class="form-check form-switch bg-light p-2 rounded border d-flex justify-content-between align-items-center">
                     <label class="form-check-label fw-bold text-danger">‡πÄ‡∏õ‡∏¥‡∏î‡πÅ‡∏™‡∏î‡∏á‡∏õ‡πâ‡∏≤‡∏¢ NEW (‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà)</label>
                     <input class="form-check-input fs-5" type="checkbox" id="swShowNewBadge">
                 </div>
             </div>
             
             <button class="btn btn-sm btn-outline-primary w-100 mt-2" onclick="saveGeneralConfig()">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</button>
          </div>
        </div>

        <div id="sec-feedback" class="content-section text-center" style="background: #fff;">
          <h3 class="fw-bold mb-5 text-dark" style="letter-spacing: 1px;">üì¢ ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
          <div class="row justify-content-center">
            <div class="col-lg-9 mb-4 position-relative">
              <div id="banner1" class="banner-btn bg-gradient-pink closed" onclick="handleBannerClick(1)" role="button">
                <div id="badge1" class="new-badge">NEW</div>
                <div class="banner-icon"><i class="material-icons">assignment</i></div>
                <div class="banner-text">
                   <div class="banner-title" id="disp_title_1">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                   <div class="banner-desc" id="disp_desc_1">...</div>
                   <div class="mt-2" id="info1">
                      <span id="statusBadge1" class="status-badge" style="display:none;">‚õî ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á</span>
                      <span class="date-badge" id="disp_date_1">...</span>
                   </div>
                </div>
              </div>
            </div>
            <div class="col-lg-9 mb-3 position-relative">
              <div id="banner2" class="banner-btn bg-gradient-yellow closed" onclick="handleBannerClick(2)" role="button">
                <div id="badge2" class="new-badge">NEW</div>
                <div class="banner-icon"><i class="material-icons">groups</i></div>
                <div class="banner-text">
                   <div class="banner-title" id="disp_title_2">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î...</div>
                   <div class="banner-desc" id="disp_desc_2">...</div>
                   <div class="mt-2" id="info2">
                      <span id="statusBadge2" class="status-badge" style="display:none;">‚õî ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</span>
                      <span class="date-badge" id="disp_date_2">...</span>
                   </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div id="sec-dash" class="content-section text-center">
          <h4 class="text-primary mb-4 fw-bold">üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
          <div id="dashboard_container" class="ratio ratio-16x9 w-100 border rounded shadow-sm bg-white overflow-hidden">
             <div id="dash_placeholder" class="d-flex flex-column align-items-center justify-content-center h-100 bg-light text-muted">
                <i class="material-icons" style="font-size: 4rem;">bar_chart</i>
                <h5 class="mt-3">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏• Dashboard</h5>
                <p>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</p>
             </div>
             <iframe id="main_dash_frame" src="" allowfullscreen style="display:none;"></iframe>
          </div>
        </div>

        <div id="sec-pr" class="content-section">
          <h4 class="text-primary mb-4 fw-bold"><i class="material-icons align-middle">campaign</i> ‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (Info-Graphics)</h4>
          <div id="prCarousel" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-indicators">
              <button type="button" data-bs-target="#prCarousel" data-bs-slide-to="0" class="active"></button>
              <button type="button" data-bs-target="#prCarousel" data-bs-slide-to="1"></button>
              <button type="button" data-bs-target="#prCarousel" data-bs-slide-to="2"></button>
            </div>
            <div class="carousel-inner">
              <div class="carousel-item active" data-bs-interval="4000"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Doi_Suthep_02.jpg/1280px-Doi_Suthep_02.jpg"></div>
              <div class="carousel-item" data-bs-interval="4000"><img src="https://thailandtourismdirectory.go.th/assets/upload/2018/01/22/2018012216262947119e830f576313.jpg"></div>
              <div class="carousel-item" data-bs-interval="4000"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f0/Chiang_Mai_Night_Bazaar.jpg/1280px-Chiang_Mai_Night_Bazaar.jpg"></div>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#prCarousel" data-bs-slide="prev"><span class="carousel-control-prev-icon bg-dark rounded-circle p-2"></span></button>
            <button class="carousel-control-next" type="button" data-bs-target="#prCarousel" data-bs-slide="next"><span class="carousel-control-next-icon bg-dark rounded-circle p-2"></span></button>
          </div>
        </div>

        <div id="sec-facebook" class="content-section">
          <h4 class="text-primary mb-4 fw-bold"><i class="material-icons align-middle">newspaper</i> ‡∏Ç‡πà‡∏≤‡∏ß‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (Facebook)</h4>
          <div class="bg-white rounded shadow-sm border p-3">
            <div class="text-center" style="overflow: hidden;">
              <div class="fb-page" 
                   data-href="https://www.facebook.com/Chiangmaioffice" 
                   data-tabs="timeline" 
                   data-width="500" 
                   data-height="350" 
                   data-small-header="true" 
                   data-adapt-container-width="true" 
                   data-hide-cover="false" 
                   data-show-facepile="false">
                <blockquote cite="https://www.facebook.com/Chiangmaioffice" class="fb-xfbml-parse-ignore">
                  <a href="https://www.facebook.com/Chiangmaioffice">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</a>
                </blockquote>
              </div>
            </div>
            <div class="text-center mt-3">
               <a href="https://www.facebook.com/Chiangmaioffice" target="_blank" class="btn btn-outline-primary btn-sm rounded-pill">
                 ‡∏î‡∏π‡∏Ç‡πà‡∏≤‡∏ß‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏ö‡∏ô Facebook <i class="material-icons align-middle fs-6">open_in_new</i>
               </a>
            </div>
          </div>
        </div>

      </div>

      <div id="page-docs" style="display:none;">
        <div class="content-section">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-header m-0 border-0 pb-0">üìÇ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</h3>
            <button id="adminAddDocBtn" class="btn btn-primary fw-bold" style="display:none;" onclick="openDocModal()">
               <i class="material-icons align-middle">add</i> ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
            </button>
          </div>
          
          <div class="row g-2 mb-3 bg-light p-3 rounded border">
             <div class="col-md-5">
                 <label class="small fw-bold">‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</label>
                 <input type="text" id="searchDoc" class="form-control" placeholder="üîç ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤..." onkeyup="filterDocs()">
             </div>
             <div class="col-md-3">
                 <label class="small fw-bold">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label>
                 <select id="filterCat" class="form-select" onchange="filterDocs()">
                    <option value="All">‡∏ó‡∏∏‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</option>
                    <option value="General">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option>
                    <option value="Plan">‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤</option>
                    <option value="Report">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•</option>
                    <option value="Announcement">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®/‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</option>
                 </select>
             </div>
             <div class="col-md-3">
                 <label class="small fw-bold">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label>
                 <select id="filterYear" class="form-select" onchange="filterDocs()">
                    <option value="All">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>
                 </select>
             </div>
             <div class="col-md-1 d-flex align-items-end">
                 <button class="btn btn-secondary w-100" onclick="clearSearch()" title="‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤"><i class="material-icons">refresh</i></button>
             </div>
          </div>
          
          <div id="docListContainer" class="list-group list-group-flush border rounded shadow-sm"></div>
          <div id="pagination" class="pagination-container"></div>
        </div>
      </div>

      <div id="page-calendar" style="display:none;">
        <div class="content-section border-0 bg-transparent p-0 mb-4 shadow-none">
          <h2 class="text-primary fw-bold"><i class="material-icons align-middle fs-2">calendar_month</i> ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h2>
          <p class="text-muted">‡∏£‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</p>
        </div>
        <div class="alert alert-info shadow-sm" role="alert">
          <i class="material-icons align-middle me-2">info</i> 
          ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á‡πÄ‡∏õ‡πá‡∏ô‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏•‡∏≤‡∏á‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà
        </div>
        <div class="content-section text-center py-5 shadow-sm border">
           <i class="material-icons text-primary mb-3" style="font-size: 5rem;">event_available</i>
           <h3 class="fw-bold text-dark">‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏•‡∏≤‡∏á ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</h3>
           <p class="text-muted mb-4">‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Server ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÇ‡∏î‡∏¢‡∏ï‡∏£‡∏á</p>
           <a href="http://164.115.44.24/cmbase/public/calendar" target="_blank" class="btn btn-primary btn-lg rounded-pill px-5 py-3 shadow">
             <i class="material-icons align-middle me-2">open_in_new</i> ‡∏Ñ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏¥‡∏î‡∏î‡∏π‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô
           </a>
           <div class="mt-3 text-muted small">(‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡πÉ‡∏´‡∏°‡πà‡∏à‡∏∞‡πÄ‡∏õ‡∏¥‡∏î‡∏Ç‡∏∂‡πâ‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ç‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•)</div>
        </div>
      </div>

      <div id="page-qa" style="display:none;">
        <div class="content-section">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <h3 class="section-header m-0 border-0 pb-0">‚ùì ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö (Q&A)</h3>
            <button id="adminAddQABtn" class="btn btn-primary fw-bold" style="display:none;" onclick="openQAModal()">
               <i class="material-icons align-middle">add</i> ‡πÄ‡∏û‡∏¥‡πà‡∏° Q&A
            </button>
          </div>
          <div class="accordion accordion-flush border rounded shadow-sm" id="accQA"></div>
        </div>
      </div>
    </div> 
  </div> 

  <footer class="main-footer container-fluid p-0">
    <div class="row m-0">
      <div class="col-lg-4 mb-4 mb-lg-0">
        <h5 class="footer-title">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h5>
        <p class="mb-2 text-white-50">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</p>
        <p class="small opacity-50">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ ‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏®‡∏≤‡∏•‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏ñ‡∏ô‡∏ô‡πÇ‡∏ä‡∏ï‡∏ô‡∏≤ <br>‡∏ï‡∏≥‡∏ö‡∏•‡∏ä‡πâ‡∏≤‡∏á‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 50300</p>
        <div id="footerCopyright">¬© 2026 All Rights Reserved.</div>
        <div class="admin-link-container">
           <a onclick="loginToggle()" class="admin-trigger"><i class="material-icons align-middle fs-6 me-1">lock</i>‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö</a>
        </div>
      </div>
      <div class="col-lg-4 mb-4 mb-lg-0">
        <h5 class="footer-title">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h5>
        <ul class="list-unstyled">
          <li class="mb-3 d-flex"><span class="me-2">üìû</span> <span>053-112-703</span></li>
          <li class="mb-3 d-flex"><span class="me-2">üìß</span> <span>plancm.700@gmail.com</span></li>
          <li class="mb-3 d-flex"><span class="me-2">üïí</span> <span>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏®‡∏∏‡∏Å‡∏£‡πå (08.30 - 16.30 ‡∏ô.)</span></li>
          <li class="mb-3 d-flex"><span class="me-2">üåê</span> <a href="http://www.chiangmai.go.th" target="_blank" class="text-decoration-none text-white-50">www.chiangmai.go.th</a></li>
        </ul>
      </div>
      <div class="col-lg-4">
        <h5 class="footer-title">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</h5>
        <div class="map-container mb-3" style="height: 200px; background: #333;">
          <iframe src="https://maps.google.com/maps?q=%E0%B8%A8%E0%B8%B2%E0%B8%A5%E0%B8%B2%E0%B8%81%E0%B8%A5%E0%B8%B2%E0%B8%87%E0%B8%88%E0%B8%B1%E0%B8%87%E0%B8%AB%E0%B8%A7%E0%B8%B1%E0%B8%94%E0%B9%80%E0%B8%8A%E0%B8%B5%E0%B8%A2%E0%B8%87%E0%B9%83%E0%B8%AB%E0%B8%A1%E0%B9%88&t=&z=15&ie=UTF8&iwloc=&output=embed" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
        <a href="https://www.google.com/maps/search/?api=1&query=‡∏®‡∏≤‡∏•‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà" target="_blank" class="btn btn-outline-light btn-sm w-100"><i class="material-icons align-middle fs-6">near_me</i> ‡∏ô‡∏≥‡∏ó‡∏≤‡∏á via Google Maps</a>
      </div>
    </div>
  </footer>

  <div class="modal fade" id="chatModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-info text-white">
          <h5 class="modal-title fw-bold"><i class="material-icons align-text-bottom me-2">smart_toy</i> ‡∏ñ‡∏≤‡∏° AI ‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-0">
          <div id="chatHistory" class="chat-container">
             <div class="chat-ai chat-msg">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏â‡∏ö‡∏±‡∏ö‡∏ô‡∏µ‡πâ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö üòä</div>
          </div>
          <div class="p-3 border-top bg-light">
             <div class="input-group">
                <input type="text" id="chatInput" class="form-control" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°..." onkeypress="if(event.key==='Enter') sendChat()">
                <button class="btn btn-primary" onclick="sendChat()"><i class="material-icons">send</i></button>
             </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="formModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title fw-bold" id="formTitle">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <form onsubmit="submitForm(event)">
            <input type="hidden" id="f_topic_type">
            <div class="mb-3"><label class="fw-bold form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-danger">*</span></label><input class="form-control" id="f_name" required></div>
            <div class="mb-3"><label class="fw-bold form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label><input class="form-control" id="f_contact"></div>
            <div class="mb-3" id="topicSelectDiv">
               <label class="fw-bold form-label">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡∏õ‡∏±‡∏ç‡∏´‡∏≤ <span class="text-danger">*</span></label>
               <select class="form-select" id="f_topic_select">
                  <option value="" selected disabled>-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
                  <option>‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏û‡∏∑‡πâ‡∏ô‡∏ê‡∏≤‡∏ô</option><option>‡∏™‡∏¥‡πà‡∏á‡πÅ‡∏ß‡∏î‡∏•‡πâ‡∏≠‡∏°/‡∏°‡∏•‡∏û‡∏¥‡∏©</option><option>‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à/‡∏≠‡∏≤‡∏ä‡∏µ‡∏û</option><option>‡∏™‡∏±‡∏á‡∏Ñ‡∏°/‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</option><option>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</option>
               </select>
            </div>
            <div class="mb-3"><label class="fw-bold form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î <span class="text-danger">*</span></label><textarea class="form-control" id="f_detail" rows="5" required></textarea></div>
            <div class="d-grid"><button class="btn btn-success py-2 fw-bold shadow-sm">üöÄ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô</button></div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="adminDocModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-dark text-white">
            <h5 class="modal-title fw-bold" id="docModalTitle">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</h5>
            <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body bg-light">
          <form id="adminDocForm" onsubmit="submitDocument(event)">
             <input type="hidden" id="doc_id">
             <div class="row g-2 mb-2">
                 <div class="col-md-9"><label class="small fw-bold text-muted">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ <span class="text-danger">*</span></label><input type="text" class="form-control" id="doc_title" required></div>
                 <div class="col-md-3"><label class="small fw-bold text-muted">‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</label><input type="text" class="form-control" id="doc_year" placeholder="‡πÄ‡∏ä‡πà‡∏ô 2567"></div>
             </div>
             <div class="mb-2"><label class="small fw-bold text-muted">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</label><input type="text" class="form-control" id="doc_desc"></div>
             <div class="row g-2 mb-2">
                <div class="col-md-6"><label class="small fw-bold text-muted">‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà</label><select class="form-select" id="doc_cat"><option value="General">‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</option><option value="Plan">‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤</option><option value="Report">‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•</option><option value="Announcement">‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®/‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á</option></select></div>
                <div class="col-md-6"><label class="small fw-bold text-muted">AI Chatbot</label><select class="form-select" id="doc_ai_status"><option value="ON">üü¢ ‡πÄ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô AI</option><option value="OFF">üî¥ ‡∏õ‡∏¥‡∏î‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô AI</option></select></div>
             </div>
             <div class="mb-3"><label class="small fw-bold text-muted">‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÑ‡∏ü‡∏•‡πå (URL) <span class="text-danger">*</span></label><input type="text" class="form-control" id="doc_link" required></div>
             <div class="p-3 border rounded bg-white">
                 <div class="row">
                     <div class="col-md-4"><label class="small fw-bold text-muted">‡∏•‡∏≥‡∏î‡∏±‡∏ö (‡πÄ‡∏•‡∏Ç‡∏ô‡πâ‡∏≠‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡∏Å‡πà‡∏≠‡∏ô)</label><input type="number" class="form-control" id="doc_order"></div>
                     <div class="col-md-4 pt-4"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="doc_is_pinned"><label class="small fw-bold text-dark">üìå ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î‡∏ö‡∏ô‡∏™‡∏∏‡∏î</label></div></div>
                     <div class="col-md-4 pt-4"><div class="form-check form-switch"><input class="form-check-input" type="checkbox" id="doc_is_important"><label class="small fw-bold text-danger">‚≠ê ‡∏ï‡∏¥‡∏î‡∏õ‡πâ‡∏≤‡∏¢‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</label></div></div>
                 </div>
             </div>
             <div class="mt-4 text-end"><button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="btn btn-success fw-bold px-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="adminQAModal" tabindex="-1" data-bs-backdrop="static">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header bg-dark text-white">
                <h5 class="modal-title fw-bold" id="qaModalTitle">‡πÄ‡∏û‡∏¥‡πà‡∏° Q&A</h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="adminQAForm" onsubmit="submitQA(event)">
                    <input type="hidden" id="qa_id">
                    <div class="row g-2 mb-2">
                        <div class="col-3"><label class="small fw-bold text-muted">‡πÑ‡∏≠‡∏Ñ‡∏≠‡∏ô</label><select class="form-select" id="qa_emoji"><option value="‚ùì">‚ùì</option><option value="üì¢">üì¢</option><option value="üî¥">üî¥</option><option value="üí°">üí°</option></select></div>
                        <div class="col-9"><label class="small fw-bold text-muted">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°</label><input type="text" class="form-control" id="qa_question" required></div>
                    </div>
                    <div class="mb-3"><label class="small fw-bold text-muted">‡∏Ñ‡∏≥‡∏ï‡∏≠‡∏ö</label><textarea class="form-control" id="qa_answer" rows="4" required></textarea></div>
                    <div class="text-end"><button type="button" class="btn btn-secondary me-2" data-bs-dismiss="modal">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button><button type="submit" class="btn btn-success fw-bold px-4">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button></div>
                </form>
            </div>
        </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    // ==========================================
    // üü¢ Javascript (‡πÇ‡∏Ñ‡∏£‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏°‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î 100%)
    // ==========================================
    let docs = [], qaList = [], filteredDocs = [];
    let isAdmin = false;
    let adminToken = "";
    let form1Open = true, form2Open = true; 
    let form1Title = "", form1Desc = "", form1Date = "";
    let form2Title = "", form2Desc = "", form2Date = "";
    let showNewBadge = true; // üü¢ ‡∏ï‡∏±‡∏ß‡πÅ‡∏õ‡∏£‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏õ‡πâ‡∏≤‡∏¢ NEW
    let currentPage = 1; const itemsPerPage = 10;
    let currentDocLink = "";

    function initSystem() { 
      document.getElementById('globalLoader').style.display = 'flex';
      
      Promise.all([
         fetchSafe(SCRIPT_URL + '?action=getSettings'),
         fetchSafe(SCRIPT_URL + '?action=getDocs'),
         fetchSafe(SCRIPT_URL + '?action=getQA')
      ]).then(([settings, docsData, qaData]) => {
         
         form1Open = (settings.form1_status === 'OPEN');
         form2Open = (settings.form2_status === 'OPEN');
         form1Title = settings.form1_title; form1Desc = settings.form1_desc; form1Date = settings.form1_date;
         form2Title = settings.form2_title; form2Desc = settings.form2_desc; form2Date = settings.form2_date;
         
         // üü¢ ‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡πâ‡∏≤‡∏¢ NEW ‡∏à‡∏≤‡∏Å Google Sheet
         showNewBadge = (settings.show_new_badge === 'ON');

         updateVideo(settings.video_url);
         updateDashboard(settings.dash_url);
         updateUI();
         
         docs = docsData;
         qaList = qaData;
         
         if(document.getElementById('page-docs').style.display === 'block') { buildYearFilter(); filterDocs(); }
         if(document.getElementById('page-qa').style.display === 'block') renderQA();

         document.getElementById('swShowNewBadge').checked = showNewBadge;

         document.getElementById('globalLoader').style.opacity = '0';
         setTimeout(() => { document.getElementById('globalLoader').style.display = 'none'; }, 300);

      }).catch(e => {
         console.error("Connection Error:", e);
         document.getElementById('globalLoader').style.display = 'none';
         Swal.fire({
             icon: 'error',
             title: '‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠',
             html: '‡πÄ‡∏Å‡∏¥‡∏î‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡∏ê‡∏≤‡∏ô‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br><br><b>‡∏ß‡∏¥‡∏ò‡∏µ‡πÅ‡∏Å‡πâ:</b><br><span class="text-danger">' + e.message + '</span>'
         });
      });
    }
    
    // üü¢ ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡πÉ‡∏´‡∏°‡πà: ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏±‡∏Å Error ‡∏Ç‡∏≤‡∏ß
    async function fetchSafe(url) {
        const response = await fetch(url);
        const text = await response.text();
        try {
            const json = JSON.parse(text);
            if (json && json.status === "ERROR") { throw new Error(json.message); }
            return json;
        } catch (e) {
            console.error("Not JSON response:", text);
            throw new Error("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏ß‡πà‡∏≤‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ Deploy ‡πÅ‡∏ö‡∏ö New Version ‡πÅ‡∏•‡πâ‡∏ß‡∏´‡∏£‡∏∑‡∏≠‡∏¢‡∏±‡∏á");
        }
    }

    // --- Video & Dash Handling ---
    function updateVideo(url) {
       let videoId = extractYouTubeID(url);
       let embedUrl = videoId ? "https://www.youtube.com/embed/" + videoId : "";
       document.getElementById('main_video_frame').src = embedUrl;
       document.getElementById('admin_video_url').value = url || "";
    }
    function extractYouTubeID(url) {
       if (!url) return null;
       var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
       var match = url.match(regExp);
       return (match && match[2].length == 11) ? match[2] : null;
    }
    function updateDashboard(url) {
       let ph = document.getElementById('dash_placeholder');
       let frame = document.getElementById('main_dash_frame');
       document.getElementById('admin_dash_url').value = url || "";
       if (url && url.length > 5) { ph.style.display = 'none'; frame.style.display = 'block'; frame.src = url; } 
       else { ph.style.display = 'flex'; frame.style.display = 'none'; }
    }

    // --- Sidebar & Layout ---
    function toggleSidebar() {
       let sidebar = document.getElementById('sidebar');
       let overlay = document.getElementById('sidebarOverlay');
       sidebar.classList.toggle('active');
       overlay.classList.toggle('active');
    }
    function showPage(id) {
      ['home','docs','calendar','qa'].forEach(p => document.getElementById('page-'+p).style.display = 'none');
      document.getElementById('page-'+id).style.display = 'block';
      document.querySelectorAll('.nav-link-main').forEach(el => el.classList.remove('active'));
      document.getElementById('menu-'+id).classList.add('active');
      if(id === 'docs') { filterDocs(); } 
      if(id === 'qa') { renderQA(); }
      window.scrollTo(0,0);
      if(window.innerWidth <= 992) {
         document.getElementById('sidebar').classList.remove('active');
         document.getElementById('sidebarOverlay').classList.remove('active');
      }
    }
    function scrollToId(id) {
       showPage('home');
       setTimeout(() => { document.getElementById(id).scrollIntoView({behavior: 'smooth', block: 'start'}); }, 100);
       if(window.innerWidth <= 992) toggleSidebar();
    }

    // --- Admin Config ---
    function saveGeneralConfig() {
       let vUrl = document.getElementById('admin_video_url').value;
       let dUrl = document.getElementById('admin_dash_url').value;
       let newBadgeStatus = document.getElementById('swShowNewBadge').checked ? 'ON' : 'OFF';
       
       postData({ action: 'updateGeneralConfig', token: adminToken, video: vUrl, dash: dUrl, showNewBadge: newBadgeStatus }, (res) => {
          if(res.status === 'SUCCESS') {
              updateVideo(vUrl); updateDashboard(dUrl); showNewBadge = (newBadgeStatus === 'ON'); filterDocs();
              Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer: 1500, showConfirmButton: false });
          } else { Swal.fire('Error', res.message, 'error'); }
       });
    }
    function saveFormConfig(num) {
       let titleVal = document.getElementById('admin_title_' + num).value;
       let descVal = document.getElementById('admin_subtitle_' + num).value;
       let dateVal = document.getElementById('admin_date_' + num).value;
       let isChecked = document.getElementById('swForm' + num).checked;
       let status = isChecked ? 'OPEN' : 'CLOSED';
       let keyName = (num === 1) ? 'FORM_1' : 'FORM_2';
       
       postData({ action: 'updateFormConfig', token: adminToken, key: keyName, title: titleVal, subtitle: descVal, dateText: dateVal, status: status }, (response) => {
          if(response.status === 'SUCCESS') {
              if (num === 1) { form1Title = titleVal; form1Desc = descVal; form1Date = dateVal; form1Open = isChecked; } 
              else { form2Title = titleVal; form2Desc = descVal; form2Date = dateVal; form2Open = isChecked; }
              updateUI();
              Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer: 1500, showConfirmButton: false });
          } else { Swal.fire('Error', response.message, 'error'); }
       });
    }
    function updateUI() {
       document.getElementById('disp_title_1').innerText = form1Title;
       document.getElementById('disp_desc_1').innerText = form1Desc;
       document.getElementById('disp_date_1').innerText = "üìÖ " + form1Date;
       document.getElementById('disp_title_2').innerText = form2Title;
       document.getElementById('disp_desc_2').innerText = form2Desc;
       document.getElementById('disp_date_2').innerText = "üìÖ " + form2Date;

       document.getElementById('admin_title_1').value = form1Title;
       document.getElementById('admin_subtitle_1').value = form1Desc;
       document.getElementById('admin_date_1').value = form1Date;
       document.getElementById('admin_title_2').value = form2Title;
       document.getElementById('admin_subtitle_2').value = form2Desc;
       document.getElementById('admin_date_2').value = form2Date;

       let b1 = document.getElementById('banner1'), st1 = document.getElementById('statusBadge1');
       if(form1Open) { b1.classList.remove('closed'); st1.style.display = 'none'; document.getElementById('badge1').style.display = 'block'; } 
       else { b1.classList.add('closed'); st1.style.display = 'inline-block'; document.getElementById('badge1').style.display = 'none'; }
       document.getElementById('swForm1').checked = form1Open;
       
       let b2 = document.getElementById('banner2'), st2 = document.getElementById('statusBadge2');
       if(form2Open) { b2.classList.remove('closed'); st2.style.display = 'none'; document.getElementById('badge2').style.display = 'block'; } 
       else { b2.classList.add('closed'); st2.style.display = 'inline-block'; document.getElementById('badge2').style.display = 'none'; }
       document.getElementById('swForm2').checked = form2Open;
    }

    // --- Core Logic (Docs, Chat, Forms) ---
    // üü¢ ‡∏î‡∏∂‡∏á‡∏õ‡∏µ‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ó‡∏≥‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á
    function buildYearFilter() {
       let years = new Set();
       docs.forEach(d => { 
           if(d.year !== undefined && d.year !== null && d.year !== "") { 
               let yearStr = d.year.toString().trim(); // ‡∏ö‡∏±‡∏á‡∏Ñ‡∏±‡∏ö‡πÄ‡∏õ‡πá‡∏ô Text ‡∏Å‡∏±‡∏ô‡∏ö‡∏±‡∏Ñ
               let parts = yearStr.split('-'); 
               if(parts.length === 2 && !isNaN(parts[0]) && !isNaN(parts[1])) { 
                   for(let y = parseInt(parts[0]); y <= parseInt(parts[1]); y++) { years.add(y.toString()); }
               } else { years.add(yearStr); } 
           }
       });
       let html = '<option value="All">‡∏ó‡∏∏‡∏Å‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì</option>';
       Array.from(years).sort((a,b)=>b-a).forEach(y => html += `<option value="${y}">‡∏õ‡∏µ ${y}</option>`);
       document.getElementById('filterYear').innerHTML = html;
    }

    // üü¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡πÄ‡∏£‡∏µ‡∏¢‡∏á (‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î -> ‡∏õ‡∏µ -> ‡∏•‡∏≥‡∏î‡∏±‡∏ö -> ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà)
    function sortDocsLogic(a, b) {
       if (a.is_pinned !== b.is_pinned) return a.is_pinned ? -1 : 1; 
       let getYearMax = (y) => { if(!y) return 0; let p = y.toString().split('-'); return p.length === 2 ? parseInt(p[1]) : parseInt(y); };
       let yA = getYearMax(a.year); let yB = getYearMax(b.year);
       if (yA !== yB) return yB - yA;
       let oA = a.order || 999; let oB = b.order || 999;
       if (oA !== oB) return oA - oB;
       return new Date(b.created) - new Date(a.created);
    }

    function filterDocs() {
       let searchText = document.getElementById('searchDoc').value.toLowerCase();
       let catFilter = document.getElementById('filterCat').value;
       let yearFilter = document.getElementById('filterYear').value;
       
       filteredDocs = docs.filter(d => {
          let mTxt = d.title.toLowerCase().includes(searchText) || (d.desc && d.desc.toLowerCase().includes(searchText));
          let mCat = (catFilter === 'All') || (d.type === catFilter);
          let mYr = (yearFilter === 'All');
          if (!mYr && d.year) { 
              let docYr = d.year.toString().trim(); let p = docYr.split('-'); 
              if (p.length === 2) { mYr = (parseInt(yearFilter) >= parseInt(p[0]) && parseInt(yearFilter) <= parseInt(p[1])); } 
              else { mYr = (yearFilter === docYr); } 
          }
          return mTxt && mCat && mYr;
       });
       filteredDocs.sort(sortDocsLogic); currentPage = 1; renderDocs();
    }
    
    function clearSearch() { 
        document.getElementById('searchDoc').value = ''; 
        document.getElementById('filterCat').value = 'All'; 
        document.getElementById('filterYear').value = 'All'; 
        filterDocs(); 
    }

    function getCatBadge(type) {
       let label = type, colorClass = 'bg-secondary';
       switch(type) { case 'General': label = '‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ'; break; case 'Plan': label = '‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤'; colorClass = 'bg-primary'; break; case 'Report': label = '‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏ú‡∏•'; colorClass = 'bg-success'; break; case 'Announcement': label = '‡∏õ‡∏£‡∏∞‡∏Å‡∏≤‡∏®/‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á'; colorClass = 'bg-warning text-dark'; break; }
       return `<span class="badge ${colorClass}">${label}</span>`;
    }

    function renderDocs() {
      let html = '';
      if(filteredDocs.length === 0) { html = '<div class="text-center text-muted py-5">‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£</div>'; document.getElementById('pagination').innerHTML = ''; } 
      else {
        let start = (currentPage - 1) * itemsPerPage;
        let end = start + itemsPerPage;
        let paginatedItems = filteredDocs.slice(start, end);
        
        paginatedItems.forEach(doc => {
          let icon = 'description', color = 'text-primary';
          if(doc.link.includes('drive')) { icon = 'add_to_drive'; color = 'text-success'; } else if(doc.link.includes('.pdf')) { icon = 'picture_as_pdf'; color = 'text-danger'; }
          let dateStr = "‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: " + formatDate(doc.created);
          
          let badges = '';
          if(doc.is_pinned) badges += `<span class="badge badge-pin me-2">üìå ‡∏õ‡∏±‡∏Å‡∏´‡∏°‡∏∏‡∏î</span>`;
          if(doc.is_important) badges += `<span class="badge bg-danger me-2">‚≠ê ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</span>`;
          
          // üåü ‡∏õ‡πâ‡∏≤‡∏¢ NEW
          let ageDays = (new Date() - new Date(doc.created)) / (1000 * 60 * 60 * 24);
          if(ageDays < 14 && showNewBadge === true) badges += `<span class="badge-custom-new me-2">NEW</span>`;
          
          // üóìÔ∏è ‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà‡πÅ‡∏•‡∏∞‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì
          let catBadge = getCatBadge(doc.type);
          let yrBadge = doc.year ? `<span class="badge bg-info text-dark ms-2"><i class="material-icons align-middle" style="font-size: 11px;">event</i> ‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì ${doc.year}</span>` : '';

          let editBtn = isAdmin ? `<button class="btn btn-sm btn-outline-warning ms-2" onclick="editDoc('${doc.id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>` : '';
          let deleteBtn = isAdmin ? `<button class="btn btn-sm btn-outline-danger ms-2" onclick="deleteDoc('${doc.id}')">‡∏•‡∏ö</button>` : '';
          let chatBtn = doc.ai_status === 'OFF' ? `<button class="btn btn-sm btn-secondary text-white opacity-50" style="cursor:not-allowed;"><i class="material-icons align-middle" style="font-size:16px;">smart_toy</i> ‡∏õ‡∏¥‡∏î AI</button>` : `<button class="btn btn-sm btn-info text-white" onclick="openChat('${doc.id}')"><i class="material-icons align-middle" style="font-size:16px;">smart_toy</i> ‡∏ñ‡∏≤‡∏° AI</button>`;
          
          html += `
            <div class="list-group-item list-group-item-action d-flex align-items-start py-4 px-3 border-bottom">
                <i class="material-icons fs-2 me-4 mt-1 ${color}">${icon}</i>
                <div class="flex-grow-1">
                    <a href="${doc.link}" target="_blank" class="text-decoration-none text-dark">
                        <div class="mb-1 d-flex align-items-center flex-wrap">${badges}</div>
                        <h5 class="mb-2 fw-bold">${doc.title}</h5>
                        <div class="mb-2 d-flex flex-wrap align-items-center">
                            ${catBadge} ${yrBadge} 
                            <span class="text-muted small ms-md-2 mt-2 mt-md-0 d-block d-md-inline w-100 w-md-auto">${doc.desc || "-"}</span>
                        </div>
                        <small class="text-secondary">${dateStr}</small>
                    </a>
                </div>
                <div class="d-flex align-items-center ms-3">
                    ${chatBtn} ${editBtn} ${deleteBtn}
                </div>
            </div>`;
        });
        renderPagination();
      }
      document.getElementById('docListContainer').innerHTML = html;
    }

    function renderPagination() {
       let totalPages = Math.ceil(filteredDocs.length / itemsPerPage);
       let html = '';
       if(totalPages > 1) {
          html += `<div class="page-btn ${currentPage===1 ? 'disabled' : ''}" onclick="changePage(${currentPage-1})">¬´</div>`;
          for(let i=1; i<=totalPages; i++) {
             if(i === 1 || i === totalPages || (i >= currentPage - 1 && i <= currentPage + 1)) { html += `<div class="page-btn ${i===currentPage ? 'active' : ''}" onclick="changePage(${i})">${i}</div>`; } 
             else if(i === currentPage - 2 || i === currentPage + 2) { html += `<span class="px-2">...</span>`; }
          }
          html += `<div class="page-btn ${currentPage===totalPages ? 'disabled' : ''}" onclick="changePage(${currentPage+1})">¬ª</div>`;
       }
       document.getElementById('pagination').innerHTML = html;
    }
    function changePage(page) {
       let totalPages = Math.ceil(filteredDocs.length / itemsPerPage);
       if(page < 1 || page > totalPages) return;
       currentPage = page; renderDocs();
    }

    // üü¢ ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ (‡πÉ‡∏ä‡πâ Pop-up)
    function openDocModal() {
       document.getElementById('adminDocForm').reset();
       document.getElementById('doc_id').value = '';
       document.getElementById('docModalTitle').innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÉ‡∏´‡∏°‡πà';
       let myModal = new bootstrap.Modal(document.getElementById('adminDocModal'));
       myModal.show();
    }
    function editDoc(id) {
       let d = docs.find(x => x.id === id); if(!d) return;
       document.getElementById('doc_id').value = d.id;
       document.getElementById('doc_title').value = d.title;
       document.getElementById('doc_year').value = d.year || '';
       document.getElementById('doc_desc').value = d.desc;
       document.getElementById('doc_link').value = d.link;
       document.getElementById('doc_cat').value = d.type;
       document.getElementById('doc_ai_status').value = d.ai_status || "ON";
       document.getElementById('doc_order').value = d.order == 999 ? "" : d.order;
       document.getElementById('doc_is_pinned').checked = d.is_pinned;
       document.getElementById('doc_is_important').checked = d.is_important;
       document.getElementById('docModalTitle').innerText = '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£';
       let myModal = new bootstrap.Modal(document.getElementById('adminDocModal'));
       myModal.show();
    }
    function submitDocument(e) {
      e.preventDefault();
      Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
      let payload = { action: 'saveDoc', token: adminToken, id: getVal('doc_id'), title: getVal('doc_title'), desc: getVal('doc_desc'), link: getVal('doc_link'), type: getVal('doc_cat'), ai_status: getVal('doc_ai_status'), year: getVal('doc_year'), order: getVal('doc_order'), is_pinned: document.getElementById('doc_is_pinned').checked, is_important: document.getElementById('doc_is_important').checked };
      postData(payload, (res) => {
          if(res.status === 'SUCCESS') { 
              let m = bootstrap.Modal.getInstance(document.getElementById('adminDocModal')); if(m) m.hide();
              Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer: 1500, showConfirmButton: false }).then(() => initSystem()); 
          } else { Swal.fire('Error', res.message, 'error'); }
      });
    }
    function deleteDoc(id) {
      Swal.fire({ title: '‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡∏ô‡∏µ‡πâ?', icon: 'warning', showCancelButton: true, confirmButtonText: '‡πÉ‡∏ä‡πà', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' }).then((result) => {
          if (result.isConfirmed) {
              Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', allowOutsideClick: false, didOpen: () => Swal.showLoading() });
              postData({ action: 'deleteDoc', token: adminToken, id: id }, (res) => {
                  if(res.status === 'SUCCESS') { Swal.fire({ icon: 'success', title: '‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', timer: 1500, showConfirmButton: false }).then(() => initSystem()); } 
                  else { Swal.fire('Error', res.message, 'error'); }
              });
          }
      });
    }

    // üü¢ ‡∏£‡∏∞‡∏ö‡∏ö AI Chat Bot ‡∏î‡∏±‡∏Å Error ‡πÉ‡∏´‡∏°‡πà ‡πÑ‡∏°‡πà‡πÄ‡∏≠‡πã‡∏≠‡πÅ‡∏ô‡πà‡∏ô‡∏≠‡∏ô
    function openChat(docId) {
       let doc = docs.find(d => d.id === docId); if(!doc) return;
       currentDocLink = doc.link;
       document.getElementById('chatHistory').innerHTML = `<div class="chat-ai chat-msg">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡∏£‡∏±‡∏ö! ‡∏ñ‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö <strong>"${doc.title}"</strong> ‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö üòä</div>`;
       let myModal = new bootstrap.Modal(document.getElementById('chatModal'));
       myModal.show();
    }
    function sendChat() {
       let input = document.getElementById('chatInput');
       let question = input.value.trim();
       if(!question) return;
       let history = document.getElementById('chatHistory');
       history.innerHTML += `<div class="chat-user chat-msg">${question}</div>`;
       input.value = ''; history.scrollTop = history.scrollHeight;
       let loadingId = 'loading_' + Date.now();
       history.innerHTML += `<div id="${loadingId}" class="chat-ai chat-msg typing-indicator"><span></span><span></span><span></span></div>`;
       history.scrollTop = history.scrollHeight;
       
       // ‡πÉ‡∏ä‡πâ fetch ‡πÅ‡∏ö‡∏ö‡∏î‡∏±‡∏Å Error HTML
       fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify({ action: 'chatWithAI', link: currentDocLink, question: question }) })
       .then(r => r.text())
       .then(text => {
           document.getElementById(loadingId).remove();
           let data;
           try { data = JSON.parse(text); } 
           catch(e) { data = {status: 'ERROR', answer: '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏ã‡∏¥‡∏£‡πå‡∏ü‡πÄ‡∏ß‡∏≠‡∏£‡πå‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î (‡∏≠‡∏≤‡∏à‡πÄ‡∏Å‡∏¥‡∏î‡∏à‡∏≤‡∏Å‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏Å‡∏≤‡∏£ Deploy)'}; }
           
           let answer = data.status === 'SUCCESS' ? data.answer : "‚ùå " + data.answer;
           answer = answer.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>').replace(/\n/g, '<br>');
           history.innerHTML += `<div class="chat-ai chat-msg">${answer}</div>`; history.scrollTop = history.scrollHeight;
       }).catch(e => {
           document.getElementById(loadingId).remove();
           history.innerHTML += `<div class="chat-ai chat-msg text-danger">‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß ‡πÇ‡∏õ‡∏£‡∏î‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</div>`;
       });
    }

    // üü¢ ‡∏£‡∏∞‡∏ö‡∏ö QA
    function openQAModal() { document.getElementById('adminQAForm').reset(); document.getElementById('qa_id').value = ''; document.getElementById('qaModalTitle').innerText = '‡πÄ‡∏û‡∏¥‡πà‡∏° Q&A'; let m = new bootstrap.Modal(document.getElementById('adminQAModal')); m.show(); }
    function editQA(id) { let q = qaList.find(x => x.id === id); if(!q) return; document.getElementById('qa_id').value = q.id; document.getElementById('qa_emoji').value = q.emoji||'‚ùì'; document.getElementById('qa_question').value = q.q; document.getElementById('qa_answer').value = q.a; document.getElementById('qaModalTitle').innerText='‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç Q&A'; let m = new bootstrap.Modal(document.getElementById('adminQAModal')); m.show(); }
    function submitQA(e) { e.preventDefault(); Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...', allowOutsideClick: false, didOpen: () => Swal.showLoading() }); postData({ action: 'saveQA', token: adminToken, id: getVal('qa_id'), q: getVal('qa_question'), a: getVal('qa_answer'), emoji: getVal('qa_emoji') }, (res) => { if(res.status==='SUCCESS'){ let m = bootstrap.Modal.getInstance(document.getElementById('adminQAModal')); if(m) m.hide(); Swal.fire({ icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', timer: 1500, showConfirmButton: false }).then(()=>initSystem()); } else Swal.fire('Error', res.message, 'error'); }); }
    function deleteQA(id) { Swal.fire({ title: '‡∏•‡∏ö‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö?', icon: 'warning', showCancelButton: true }).then((r) => { if (r.isConfirmed) { Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏•‡∏ö...', didOpen: () => Swal.showLoading() }); postData({ action: 'deleteQA', token: adminToken, id: id }, (res) => { if(res.status==='SUCCESS'){ Swal.fire('‡∏•‡∏ö‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '', 'success').then(()=>initSystem());} else Swal.fire('Error', res.message, 'error'); }); } }); }
    function renderQA() {
       let html = '';
       if(qaList.length === 0) { html = '<div class="text-center text-muted py-5">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö</div>'; }
       else {
          qaList.forEach((item, index) => {
             let editBtn = isAdmin ? `<button class="btn btn-sm btn-outline-warning ms-2" onclick="editQA('${item.id}')">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>` : '';
             let deleteBtn = isAdmin ? `<button class="btn btn-sm btn-outline-danger ms-2" onclick="deleteQA('${item.id}')">‡∏•‡∏ö</button>` : '';
             let adminControls = isAdmin ? `<div class="mt-2 text-end border-top pt-2">${editBtn} ${deleteBtn}</div>` : '';
             html += `<div class="accordion-item border rounded mb-3 shadow-sm"><h2 class="accordion-header"><button class="accordion-button collapsed fw-bold text-start" type="button" data-bs-toggle="collapse" data-bs-target="#qa${index}"><span class="me-2 fs-5">${item.emoji}</span> ${item.q}</button></h2><div id="qa${index}" class="accordion-collapse collapse" data-bs-parent="#accQA"><div class="accordion-body text-muted bg-light">${item.a}${adminControls}</div></div></div>`;
          });
       }
       document.getElementById('accQA').innerHTML = html;
    }

    function handleBannerClick(num) {
       let isOpen = (num === 1) ? form1Open : form2Open;
       let title = (num === 1) ? form1Title : form2Title;
       if (isOpen) { openFormModal(num === 1 ? 'general' : 'special', title); } 
       else { Swal.fire({ icon: 'warning', title: '‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢', text: '‡∏£‡∏∞‡∏ö‡∏ö‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏ô‡∏µ‡πâ‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß' }); }
    }
    function openFormModal(type, titleText) {
       document.getElementById('formTitle').innerText = titleText; 
       document.getElementById('f_topic_type').value = titleText;
       if(type === 'general') { document.getElementById('topicSelectDiv').style.display = 'block'; } 
       else { document.getElementById('topicSelectDiv').style.display = 'none'; }
       let myModal = new bootstrap.Modal(document.getElementById('formModal'));
       myModal.show();
    }
    function submitForm(e) {
      e.preventDefault();
      let btn = e.target.querySelector('button'); let oldText = btn.innerText;
      btn.disabled = true; btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';
      let topicVal = document.getElementById('f_topic_type').value;
      let topicKey = (topicVal === form1Title) ? "FORM_1_STATUS" : "FORM_2_STATUS"; 
      if(document.getElementById('topicSelectDiv').style.display === 'block') {
         let select = document.getElementById('f_topic_select');
         if(select.value === "") { Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡∏°‡∏ß‡∏î‡∏´‡∏°‡∏π‡πà'); btn.disabled = false; btn.innerText = oldText; return; }
         topicVal = select.value + " (" + topicVal + ")";
      }
      postData({ action:'saveForm', name: getVal('f_name'), contact: getVal('f_contact'), detail: getVal('f_detail'), topic: topicVal, topicKey: topicKey }, (response) => { 
         if (response.status === 'CLOSED_ERROR') {
            Swal.fire('‡πÄ‡∏™‡∏µ‡∏¢‡πÉ‡∏à‡∏î‡πâ‡∏ß‡∏¢', '‡∏ü‡∏≠‡∏£‡πå‡∏°‡∏ô‡∏µ‡πâ‡πÄ‡∏û‡∏¥‡πà‡∏á‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏õ‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏π‡πà‡∏ô‡∏µ‡πâ', 'error');
            if (topicKey === "FORM_1_STATUS") { form1Open = false; } else { form2Open = false; }
            updateUI();
            let m = bootstrap.Modal.getInstance(document.getElementById('formModal')); if(m) m.hide();
         } else {
            Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß','success'); 
            document.getElementById('formModal').querySelector('form').reset(); 
            let m = bootstrap.Modal.getInstance(document.getElementById('formModal')); if(m) m.hide(); 
         }
         btn.disabled = false; btn.innerText = oldText; 
      });
    }
    
    // --- Login System ---
    function loginToggle() {
      if(isAdmin) return logoutSystem();
      Swal.fire({
        title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö',
        html: '<input id="swal-input1" class="swal2-input" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Username)">' +
              '<input id="swal-input2" class="swal2-input" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô (Password)" type="password">',
        focusConfirm: false,
        confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö',
        preConfirm: () => {
          return [ document.getElementById('swal-input1').value, document.getElementById('swal-input2').value ]
        }
      }).then((result) => {
        if (result.value) {
          const username = result.value[0]; const password = result.value[1];
          if (!username || !password) { Swal.fire('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÉ‡∏´‡πâ‡∏Ñ‡∏£‡∏ö'); return; }
          
          Swal.fire({ title: '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...', didOpen: () => Swal.showLoading() });
          postData({action: 'login', username: username, password: password}, (data) => {
             if(data.status === 'SUCCESS') { 
                 adminToken = password;
                 setAdminMode(true); 
                 Swal.fire({icon: 'success', title: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', timer: 1500, showConfirmButton: false}); 
             } else { Swal.fire({icon: 'error', title: '‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏´‡∏£‡∏∑‡∏≠‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'}); }
          });
        }
      });
    }

    function logoutSystem() {
      Swal.fire({ title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö?', icon: 'question', showCancelButton: true, confirmButtonText: '‡πÉ‡∏ä‡πà', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å' }).then((res) => {
        if(res.isConfirmed) { 
            adminToken = "";
            setAdminMode(false); 
            Swal.fire({icon: 'success', title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', timer: 1500, showConfirmButton: false}); 
        }
      });
    }

    function setAdminMode(status) {
       isAdmin = status;
       if(status) {
          document.getElementById('adminHomePanel').style.display='block';
          document.getElementById('sidebarLogoutArea').style.display='block';
          
          // üü¢ ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏° Add ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£ ‡πÅ‡∏•‡∏∞ Q&A
          let addDocBtn = document.getElementById('adminAddDocBtn'); if(addDocBtn) addDocBtn.style.display='inline-block';
          let addQABtn = document.getElementById('adminAddQABtn'); if(addQABtn) addQABtn.style.display='inline-block';
       } else {
          document.getElementById('adminHomePanel').style.display='none';
          document.getElementById('sidebarLogoutArea').style.display='none';
          
          let addDocBtn = document.getElementById('adminAddDocBtn'); if(addDocBtn) addDocBtn.style.display='none';
          let addQABtn = document.getElementById('adminAddQABtn'); if(addQABtn) addQABtn.style.display='none';
       }
       renderDocs(); renderQA();
    }
    function postData(data, callback) { fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) }).then(r => r.json()).then(d => callback(d)).catch(e => console.error(e)); }
    function getVal(id) { return document.getElementById(id).value; }
    function formatDate(isoStr) { if(!isoStr) return ""; let d = new Date(isoStr); return d.toLocaleDateString('th-TH') + ' ' + d.toLocaleTimeString('th-TH', {hour:'2-digit', minute:'2-digit'}); }
  </script>
</body>
</html>
