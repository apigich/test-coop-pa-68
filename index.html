<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; margin: 0; display: flex; flex-direction: column; min-height: 100vh; font-size: 0.95rem; }
    
    /* Header */
    .main-header { background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Doi_Suthep_02.jpg/1200px-Doi_Suthep_02.jpg') center/cover; color: white; padding: 60px 0; position: relative; }
    .header-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(90deg, rgba(13,110,253,0.9), rgba(0,50,133,0.7)); }
    .header-content { position: relative; z-index: 2; padding: 0 20px; }
    
    /* Sidebar */
    .sidebar { min-height: 100vh; background: white; border-right: 1px solid #ddd; padding-top: 20px; }
    .nav-link-main { padding: 12px 20px; color: #0d6efd; font-weight: bold; cursor: pointer; display: block; text-decoration: none; border-bottom: 1px solid #f0f0f0; }
    .nav-link-main:hover, .nav-link-main.active { background: #e7f1ff; border-left: 4px solid #0d6efd; }
    .nav-link-sub { padding: 8px 20px 8px 40px; color: #666; cursor: pointer; display: block; text-decoration: none; font-size: 0.9rem; }
    .nav-link-sub:hover { color: #0d6efd; }

    /* Content */
    .content-section { background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    
    /* Banner Buttons Style */
    .banner-btn {
      display: flex; align-items: center; justify-content: space-between;
      padding: 20px; margin-bottom: 15px; border-radius: 50px;
      color: white; cursor: pointer; transition: transform 0.2s; box-shadow: 0 4px 6px rgba(0,0,0,0.1);
      position: relative; overflow: hidden;
    }
    .banner-btn:hover { transform: scale(1.02); }
    .banner-icon { font-size: 3rem; background: rgba(255,255,255,0.2); padding: 10px; border-radius: 50%; }
    .banner-text { text-align: right; flex-grow: 1; padding-left: 15px; }
    .banner-title { font-weight: bold; font-size: 1.2rem; margin-bottom: 5px; }
    .banner-desc { font-size: 0.9rem; opacity: 0.9; }
    
    .bg-gradient-pink { background: linear-gradient(90deg, #ff7eb3, #ff758c); }
    .bg-gradient-yellow { background: linear-gradient(90deg, #fce38a, #f38181); }

    /* Calendar & Events */
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); border: 1px solid #ddd; }
    .day-cell { min-height: 80px; border: 1px solid #eee; padding: 5px; background: white; }
    .event-badge { display: block; background: #0d6efd; color: white; font-size: 12px; padding: 2px 5px; margin-bottom: 2px; border-radius: 4px; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .delete-btn { float: right; color: white; background: red; border-radius: 50%; width: 15px; height: 15px; text-align: center; line-height: 15px; font-size: 10px; cursor: pointer; display: none; }
    
    .admin-controls { display: none; background: #fff3cd; border: 1px solid #ffeeba; padding: 20px; border-radius: 10px; margin-bottom: 20px; }

    /* Footer */
    .main-footer { background-color: #1a1d20; color: #cfd2d6; padding: 100px 40px 120px 40px; margin-top: auto; border-top: none; width: 100%; }
    .main-footer h5 { color: white; font-weight: 700; margin-bottom: 20px; border-left: 4px solid #0d6efd; padding-left: 10px; line-height: 1.6; margin-top: 0; }
    .admin-trigger { cursor: pointer; opacity: 0.3; transition: 0.3s; }
    .admin-trigger:hover { opacity: 1; color: #ffc107; }
    .map-container { border-radius: 10px; overflow: hidden; box-shadow: 0 4px 10px rgba(0,0,0,0.3); border: 2px solid #343a40; }

    @media (max-width: 768px) {
      .sidebar { position: static; height: auto; border-right: none; }
      .day-cell { min-height: 60px; }
      .main-footer { padding: 60px 20px 80px 20px; }
    }
  </style>
</head>
<body onload="initSystem()">

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGWDn2t6cPkNDJyuYN_RXvBfB_m7MM1gdHs4-QVKLhRWOhkDjbxeOQxoAc3ZKoJaZFEg/exec"; 
  </script>

  <header class="main-header">
    <div class="header-overlay"></div>
    <div class="header-content d-flex align-items-center">
      <i class="material-icons" style="font-size: 3.5rem; margin-right: 15px;">account_balance</i>
      <div>
        <h1 class="m-0 fw-bold" style="font-size: 1.5rem;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h1>
        <small>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</small>
      </div>
    </div>
  </header>

  <div class="container-fluid p-0 d-flex flex-grow-1">
    
    <div class="sidebar col-md-2 d-none d-md-block">
      <h6 class="px-3 text-secondary fw-bold">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</h6>
      <a class="nav-link-main active" id="menu-home" onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <div id="sub-home">
        <a class="nav-link-sub" onclick="scrollToId('sec-pr')">- ‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</a>
        <a class="nav-link-sub" onclick="scrollToId('sec-feedback')">- ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</a>
        <a class="nav-link-sub" onclick="scrollToId('sec-dash')">- Dashboard</a>
      </div>
      <a class="nav-link-main" id="menu-docs" onclick="showPage('docs')">üìÇ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
      <a class="nav-link-main" id="menu-calendar" onclick="showPage('calendar')">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
      <a class="nav-link-main" id="menu-qa" onclick="showPage('qa')">‚ùì ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö (Q&A)</a>
      
      <div class="mt-4 px-3">
         <button id="adminBtn" class="btn btn-outline-secondary btn-sm w-100" onclick="loginToggle()">üîê Admin Login</button>
      </div>
    </div>

    <div class="col-md-10 col-12 bg-light p-4">
      
      <div id="page-home">
        
        <div id="sec-pr" class="content-section">
          <h4 class="text-primary fw-bold mb-3"><i class="material-icons align-middle">campaign</i> ‡∏™‡∏∑‡πà‡∏≠‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</h4>
          <div class="row">
            <div class="col-md-4 mb-3">
               <div class="card h-100 shadow-sm">
                 <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Doi_Suthep_02.jpg/640px-Doi_Suthep_02.jpg" class="card-img-top" style="height:150px; object-fit:cover;">
                 <div class="card-body"><h6 class="card-title fw-bold">‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏™‡∏£‡∏£‡∏Ñ‡πå</h6><p class="small text-muted">‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏±‡∏ö‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏®‡∏£‡∏©‡∏ê‡∏Å‡∏¥‡∏à...</p></div>
               </div>
            </div>
            <div class="col-md-4 mb-3">
               <div class="card h-100 shadow-sm">
                 <img src="https://thailandtourismdirectory.go.th/assets/upload/2018/01/22/2018012216262947119e830f576313.jpg" class="card-img-top" style="height:150px; object-fit:cover;">
                 <div class="card-body"><h6 class="card-title fw-bold">‡πÄ‡∏ó‡∏®‡∏Å‡∏≤‡∏•‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ‡∏ö‡∏≤‡∏ô</h6><p class="small text-muted">‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏ß‡∏ä‡∏°‡∏™‡∏ß‡∏ô‡∏î‡∏≠‡∏Å‡πÑ‡∏°‡πâ...</p></div>
               </div>
            </div>
            <div class="col-md-4 mb-3">
               <div class="card h-100 shadow-sm bg-light d-flex align-items-center justify-content-center">
                 <div class="text-center text-muted"><i class="material-icons fs-1">add_photo_alternate</i><br>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</div>
               </div>
            </div>
          </div>
        </div>

        <div id="sec-feedback" class="content-section text-center">
          <h3 class="fw-bold mb-4" style="color: #333;">üì¢ ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
          
          <div class="row justify-content-center">
            
            <div class="col-md-8 mb-3">
              <div class="banner-btn bg-gradient-pink" onclick="openFormModal('general')">
                <div class="banner-icon"><i class="material-icons">assignment</i></div>
                <div class="banner-text">
                   <div class="banner-title">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
                   <div class="banner-desc">(‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                   <div class="banner-desc text-warning fw-bold">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö: 1 ‡∏°.‡∏Ñ. 68 - 31 ‡∏ò.‡∏Ñ. 68</div>
                </div>
              </div>
            </div>

            <div class="col-md-8 mb-3" id="specialBanner" style="display:none;">
              <div class="banner-btn bg-gradient-yellow" onclick="openFormModal('special')">
                <div class="banner-icon"><i class="material-icons">lightbulb</i></div>
                <div class="banner-text">
                   <div class="banner-title">‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢: ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 2030</div>
                   <div class="banner-desc">(‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©)</div>
                   <div class="banner-desc text-danger fw-bold">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö: 1 ‡∏Å.‡∏û. 68 - 28 ‡∏Å.‡∏û. 68</div>
                </div>
              </div>
            </div>

            <div class="col-md-8" id="specialBannerClosed" style="display:none;">
               <div class="alert alert-secondary">üö´ ‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏© ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
            </div>

          </div>
        </div>

        <div id="sec-dash" class="content-section text-center">
          <h4 class="text-primary mb-3">üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
          <div class="p-5 border border-dashed rounded bg-light">
             <i class="material-icons fs-1 text-muted">bar_chart</i>
             <p>‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
          </div>
        </div>
      </div>

      <div id="page-docs" style="display:none;">
        <div class="content-section">
          <h3 class="text-primary mb-4">üìÇ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</h3>
          <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center py-3">
              <i class="material-icons fs-3 me-3 text-danger">picture_as_pdf</i>
              <div><h6 class="mb-0 fw-bold">‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏â‡∏ö‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (PDF)</h6><small class="text-muted">‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡πÄ‡∏°‡∏∑‡πà‡∏≠: 25 ‡∏°.‡∏Ñ. 68</small></div>
            </a>
            <a href="http://www.chiangmai.go.th" target="_blank" class="list-group-item list-group-item-action d-flex align-items-center py-3">
              <i class="material-icons fs-3 me-3 text-primary">language</i>
              <div><h6 class="mb-0 fw-bold">‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</h6><small class="text-muted">www.chiangmai.go.th</small></div>
            </a>
          </div>
        </div>
      </div>

      <div id="page-calendar" style="display:none;">
        <div class="d-flex justify-content-between mb-3 align-items-center">
          <h3 class="text-primary">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
        </div>

        <div id="adminPanel" class="content-section bg-warning-subtle mb-3" style="display:none;">
          <h5 class="fw-bold"><i class="material-icons align-middle">admin_panel_settings</i> ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h5>
          <hr>
          
          <div class="form-check form-switch mb-4 bg-white p-3 rounded shadow-sm">
             <input class="form-check-input" type="checkbox" id="toggleSpecialForm" onchange="toggleSpecialForm()">
             <label class="form-check-label fw-bold" for="toggleSpecialForm">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏© (Banner ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)"</label>
             <div class="small text-muted">‡∏´‡∏≤‡∏Å‡∏õ‡∏¥‡∏î ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á</div>
          </div>

          <h6 class="fw-bold mt-3">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</h6>
          <form onsubmit="submitCalendar(event)">
            <input class="form-control mb-2" id="c_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" required>
            <div class="row mb-2">
              <div class="col"><input type="date" class="form-control" id="c_start" required></div>
              <div class="col"><input type="date" class="form-control" id="c_end"></div>
              <div class="col-2"><input type="color" class="form-control" id="c_color" value="#0d6efd"></div>
            </div>
            <input class="form-control mb-2" id="c_desc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
            <input class="form-control mb-2" id="c_link" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå">
            <button class="btn btn-dark w-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
          </form>
        </div>

        <div class="calendar-container bg-white p-3 rounded shadow-sm">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <button class="btn btn-light" onclick="changeMonth(-1)"><</button>
            <h4 id="monthDisplay" class="m-0">...</h4>
            <button class="btn btn-light" onclick="changeMonth(1)">></button>
          </div>
          <div class="calendar-grid" id="calBody">Loading...</div>
        </div>
      </div>

      <div id="page-qa" style="display:none;">
        <div class="content-section">
          <h3 class="text-primary">‚ùì ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö (Q&A)</h3>
          <div class="accordion" id="accQA">
            <div class="accordion-item">
              <h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#q1">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£?</button></h2>
              <div id="q1" class="accordion-collapse collapse show"><div class="accordion-body">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...</div></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <div class="modal fade" id="formModal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="formTitle">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form onsubmit="submitForm(event)">
            <input type="hidden" id="f_topic_type">
            <div class="mb-3">
               <label class="fw-bold">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label>
               <input class="form-control" id="f_name" required>
            </div>
            <div class="mb-3">
               <label class="fw-bold">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
               <input class="form-control" id="f_contact">
            </div>
            <div class="mb-3">
               <label class="fw-bold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</label>
               <textarea class="form-control" id="f_detail" rows="4" required></textarea>
            </div>
            <button class="btn btn-success w-100">‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="eventDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg" style="border-radius: 15px; overflow: hidden;">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title fw-bold" id="modalEventTitle">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4 bg-light">
          <div class="d-flex align-items-start mb-3">
            <i class="material-icons text-primary me-2">event</i>
            <div><small class="text-muted fw-bold">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</small><div id="modalEventDate" class="fw-bold text-dark"></div></div>
          </div>
          <div class="d-flex align-items-start mb-4">
            <i class="material-icons text-primary me-2">info</i>
            <div><small class="text-muted fw-bold">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</small><div id="modalEventDesc" class="text-dark" style="white-space: pre-line;"></div></div>
          </div>
          <a id="modalEventLink" href="#" target="_blank" class="btn btn-primary w-100 py-2 rounded-pill shadow-sm"><i class="material-icons align-text-bottom fs-6 me-1">open_in_new</i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå</a>
        </div>
      </div>
    </div>
  </div>

  <script>
    let currentDate = new Date();
    let events = [];
    let isAdmin = false;
    let specialFormOpen = true;

    function initSystem() { 
      fetchEvents(); 
      checkSettings(); 
    }

    // --- Navigation ---
    function showPage(id) {
      ['home','docs','calendar','qa'].forEach(p => document.getElementById('page-'+p).style.display = 'none');
      document.getElementById('page-'+id).style.display = 'block';
      document.querySelectorAll('.nav-link-main').forEach(el => el.classList.remove('active'));
      document.getElementById('menu-'+id).classList.add('active');
      if(id === 'calendar') renderCalendar();
      window.scrollTo(0,0);
    }
    
    function scrollToId(id) {
       showPage('home');
       setTimeout(() => {
         document.getElementById(id).scrollIntoView({behavior: 'smooth', block: 'start'});
       }, 100);
    }

    // --- Settings / Toggle Form ---
    function checkSettings() {
       fetch(SCRIPT_URL + '?action=getSettings').then(r => r.json()).then(data => {
            specialFormOpen = (data.status === 'OPEN');
            updateBannerDisplay();
            document.getElementById('toggleSpecialForm').checked = specialFormOpen;
       });
    }

    function toggleSpecialForm() {
       let isChecked = document.getElementById('toggleSpecialForm').checked;
       let status = isChecked ? 'OPEN' : 'CLOSED';
       postData({ action: 'toggleForm', status: status }, () => {
          specialFormOpen = isChecked;
          updateBannerDisplay();
          const Toast = Swal.mixin({toast: true, position: 'top-end', showConfirmButton: false, timer: 3000});
          Toast.fire({icon: 'success', title: '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏•‡πâ‡∏ß'});
       });
    }

    function updateBannerDisplay() {
       if (isAdmin) {
          document.getElementById('specialBanner').style.display = 'block';
          document.getElementById('specialBanner').style.opacity = specialFormOpen ? '1' : '0.5';
          document.getElementById('specialBannerClosed').style.display = 'none';
       } else {
          document.getElementById('specialBanner').style.display = specialFormOpen ? 'block' : 'none';
          document.getElementById('specialBannerClosed').style.display = specialFormOpen ? 'none' : 'block';
       }
    }

    // --- Forms ---
    var modalForm;
    function openFormModal(type) {
       modalForm = new bootstrap.Modal(document.getElementById('formModal'));
       let title = (type === 'general') ? '‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' : '‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢: ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 2030';
       document.getElementById('formTitle').innerText = title;
       document.getElementById('f_topic_type').value = title;
       modalForm.show();
    }

    function submitForm(e) {
      e.preventDefault();
      let data = { action:'saveForm', name: getVal('f_name'), contact: getVal('f_contact'), detail: getVal('f_detail'), topic: getVal('f_topic_type') };
      postData(data, () => { 
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß','success'); 
        document.forms[0].reset();
        modalForm.hide();
      });
    }

    // --- Calendar & Popup ---
    function fetchEvents() { fetch(SCRIPT_URL + '?action=getEvents').then(r => r.json()).then(data => { events = data; renderCalendar(); }); }
    
    function renderCalendar() {
      const y = currentDate.getFullYear(), m = currentDate.getMonth();
      document.getElementById('monthDisplay').innerText = new Date(y, m).toLocaleDateString('th-TH', {month:'long', year:'numeric'});
      const firstDay = new Date(y, m, 1).getDay();
      const daysInMonth = new Date(y, m+1, 0).getDate();
      
      let html = '';
      for(let i=0; i<firstDay; i++) html += '<div class="day-cell bg-light"></div>';
      for(let d=1; d<=daysInMonth; d++) {
        let dateKey = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        let daysEvents = events.filter(e => dateKey >= e.startDate && dateKey <= e.endDate);
        let evHtml = daysEvents.map(e => 
          `<div class="event-badge" style="background:${e.color}" onclick="openEventDetail('${e.id}')">
             ${e.title} ${isAdmin ? `<span class="delete-btn" onclick="delEvent('${e.id}', event)">x</span>` : ''}
           </div>`
        ).join('');
        html += `<div class="day-cell"><div class="fw-bold">${d}</div>${evHtml}</div>`;
      }
      document.getElementById('calBody').innerHTML = html;
      if(isAdmin) document.querySelectorAll('.delete-btn').forEach(el => el.style.display = 'block');
    }

    function openEventDetail(id) {
      let ev = events.find(e => e.id === id);
      if(!ev) return;
      document.getElementById('modalEventTitle').innerText = ev.title;
      let dateRange = formatDateThai(ev.startDate);
      if(ev.startDate !== ev.endDate) dateRange += " - " + formatDateThai(ev.endDate);
      document.getElementById('modalEventDate').innerText = dateRange;
      document.getElementById('modalEventDesc').innerText = ev.desc || "-";
      let linkBtn = document.getElementById('modalEventLink');
      if(ev.link) { linkBtn.href = ev.link; linkBtn.style.display = 'block'; } else { linkBtn.style.display = 'none'; }
      new bootstrap.Modal(document.getElementById('eventDetailModal')).show();
    }

    function formatDateThai(dateStr) {
      if(!dateStr) return "";
      let d = new Date(dateStr);
      let months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
      return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
    }
    
    function changeMonth(n) { currentDate.setMonth(currentDate.getMonth()+n); renderCalendar(); }
    
    function submitCalendar(e) {
      e.preventDefault();
      let data = { action:'saveCalendar', title: getVal('c_name'), startDate: getVal('c_start'), endDate: getVal('c_end'), color: getVal('c_color'), desc: getVal('c_desc'), link: getVal('c_link') };
      postData(data, () => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß','success'); fetchEvents(); });
    }
    
    function delEvent(id, e) {
      e.stopPropagation();
      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?', icon: 'warning', showCancelButton: true, confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then((result) => {
        if (result.isConfirmed) {
          postData({action:'deleteEvent', id: id}, () => { Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '', 'success'); fetchEvents(); });
        }
      });
    }

    // --- Admin Login ---
    function loginToggle() {
      if(isAdmin) { 
        isAdmin = false; 
        document.getElementById('adminPanel').style.display='none'; 
        document.getElementById('adminBtn').innerHTML = 'üîê Admin Login'; 
        updateBannerDisplay();
        renderCalendar(); 
        Swal.fire({icon: 'success', title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', timer: 1500, showConfirmButton: false});
        return; 
      }
      Swal.fire({ title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', input: 'password' }).then(res => {
        if(!res.value) return;
        postData({action: 'login', password: res.value}, (data) => {
           if(data.status === 'SUCCESS') {
              isAdmin=true; 
              document.getElementById('adminPanel').style.display='block'; 
              document.getElementById('adminBtn').innerHTML = 'üö™ Logout'; 
              updateBannerDisplay(); 
              renderCalendar(); 
              Swal.fire({icon: 'success', title: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à', timer: 1500, showConfirmButton: false});
           } else {
              Swal.fire('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î');
           }
        });
      });
    }

    function postData(data, callback) { 
       fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) })
       .then(r => r.json())
       .then(d => callback(d))
       .catch(e => console.error(e)); 
    }
    function getVal(id) { return document.getElementById(id).value; }
  </script>
</body>
</html>
