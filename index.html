<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</title>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    /* === Global Styles === */
    body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; margin: 0; padding: 0; display: flex; flex-direction: column; min-height: 100vh; font-size: 0.95rem; }
    
    /* === Header === */
    .main-header { 
      background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Doi_Suthep_02.jpg/1200px-Doi_Suthep_02.jpg') center center/cover no-repeat; 
      color: white; padding: 70px 0; position: relative; 
    }
    .header-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(90deg, rgba(13, 110, 253, 0.9) 0%, rgba(0, 50, 133, 0.7) 100%); z-index: 1; }
    .header-content { position: relative; z-index: 2; padding: 0 40px; }
    
    /* === Sidebar Navigation === */
    .sidebar { min-height: 100vh; background: white; border-right: 1px solid #e9ecef; padding-top: 20px; }
    .nav-link-main { 
      padding: 12px 20px; color: #0d6efd; font-weight: 700; cursor: pointer; display: block; 
      text-decoration: none; border-bottom: 1px solid #f8f9fa; transition: 0.2s; font-size: 1rem;
    }
    .nav-link-main:hover { background-color: #f1f8ff; color: #0a58ca; padding-left: 25px; }
    .nav-link-main.active { background-color: #e7f1ff; border-left: 5px solid #0d6efd; color: #0d6efd; }

    .nav-link-sub { 
      padding: 8px 20px 8px 45px; color: #6c757d; cursor: pointer; display: block; 
      text-decoration: none; font-size: 0.9rem; transition: 0.2s; position: relative;
    }
    .nav-link-sub:hover { color: #0d6efd; background-color: #f8f9fa; transform: translateX(5px); }
    .nav-link-sub::before { content: "‚Ä¢"; position: absolute; left: 30px; top: 50%; transform: translateY(-50%); font-size: 1.2rem; color: #dee2e6; }

    /* === Content Area === */
    .content-section { background: white; padding: 30px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.03); margin-bottom: 25px; border: 1px solid #fff; }
    .section-header { padding-bottom: 10px; margin-bottom: 20px; color: #0d6efd; font-weight: 700; font-size: 1.4rem; border-bottom: 2px solid #f0f0f0; }

    /* === Banner Buttons (‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô) === */
    .banner-btn {
      display: flex; align-items: center; justify-content: space-between;
      padding: 25px; margin-bottom: 20px; border-radius: 15px;
      color: white; cursor: pointer; transition: all 0.3s ease; 
      box-shadow: 0 4px 10px rgba(0,0,0,0.1); position: relative; overflow: hidden;
      border: none; width: 100%; text-align: left; /* ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏ß‡πà‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏Å‡∏î */
    }
    .banner-btn:hover { transform: translateY(-3px); box-shadow: 0 8px 20px rgba(0,0,0,0.2); color: white; }
    .banner-icon { font-size: 3.5rem; background: rgba(255,255,255,0.25); padding: 15px; border-radius: 50%; }
    .banner-text { text-align: right; flex-grow: 1; padding-left: 20px; }
    .banner-title { font-weight: 800; font-size: 1.4rem; margin-bottom: 5px; line-height: 1.2; }
    .banner-desc { font-size: 0.95rem; opacity: 0.95; font-weight: 300; }
    
    .bg-gradient-pink { background: linear-gradient(135deg, #ff7eb3 0%, #ff758c 100%); }
    .bg-gradient-yellow { background: linear-gradient(135deg, #fce38a 0%, #f38181 100%); color: #4a4a4a !important; }
    .bg-gradient-yellow .banner-desc { color: #d63031; font-weight: bold; }

    /* === Calendar === */
    .calendar-container { background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
    .calendar-header { display: flex; justify-content: space-between; align-items: center; background: #0d6efd; color: white; padding: 20px; }
    .btn-nav { background: rgba(255,255,255,0.2); border: none; color: white; border-radius: 50%; width: 40px; height: 40px; cursor: pointer; transition: 0.2s; }
    .btn-nav:hover { background: rgba(255,255,255,0.4); }
    
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); border-left: 1px solid #eee; border-bottom: 1px solid #eee; }
    .day-name { background: #f8f9fa; text-align: center; font-weight: bold; padding: 15px 5px; border-right: 1px solid #eee; border-bottom: 1px solid #eee; color: #666; }
    .day-cell { min-height: 120px; border-right: 1px solid #eee; border-bottom: 1px solid #eee; padding: 8px; position: relative; background: white; transition: 0.2s; }
    .day-cell:hover { background-color: #fafafa; }
    .day-cell.today { background-color: #f0f7ff; }
    .day-number { font-weight: bold; width: 30px; height: 30px; text-align: center; line-height: 30px; border-radius: 50%; margin-bottom: 5px; color: #444; }
    .day-cell.today .day-number { background: #0d6efd; color: white; }
    
    .event-badge { 
      display: block; font-size: 0.8rem; padding: 4px 25px 4px 8px; 
      margin-bottom: 4px; border-radius: 4px; color: white; cursor: pointer; 
      white-space: nowrap; overflow: hidden; text-overflow: ellipsis; position: relative;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1); transition: 0.2s;
    }
    .event-badge:hover { transform: scale(1.02); z-index: 2; opacity: 0.9; }
    
    /* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö (‡∏Å‡∏≤‡∏Å‡∏ö‡∏≤‡∏ó) */
    .delete-btn { 
      position: absolute; right: 4px; top: 50%; transform: translateY(-50%); 
      color: white; font-weight: bold; cursor: pointer; font-size: 10px; 
      padding: 0; border-radius: 50%; background: rgba(0,0,0,0.2); 
      width: 18px; height: 18px; text-align: center; line-height: 18px; 
      display: none; 
    }
    .delete-btn:hover { background: rgba(255,0,0,0.8); }

    /* === Footer (‡πÅ‡∏Å‡πâ‡πÉ‡∏´‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô) === */
    .main-footer { background-color: #1a1d20; color: #cfd2d6; padding: 60px 40px; margin-top: auto; border-top: 5px solid #0d6efd; }
    .footer-title { color: white; font-weight: 700; margin-bottom: 20px; border-left: 4px solid #0d6efd; padding-left: 10px; }
    .admin-trigger { cursor: pointer; opacity: 0.3; transition: 0.3s; margin-top: 20px; display: inline-block; }
    .admin-trigger:hover { opacity: 1; color: #ffc107; }

    @media (max-width: 768px) {
      .sidebar { position: static; height: auto; border-right: none; }
      .header-content { text-align: center; display: block !important; }
      .banner-btn { flex-direction: column; text-align: center; }
      .banner-text { text-align: center; padding-left: 0; padding-top: 10px; }
    }
  </style>
</head>
<body onload="initSystem()">

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGWDn2t6cPkNDJyuYN_RXvBfB_m7MM1gdHs4-QVKLhRWOhkDjbxeOQxoAc3ZKoJaZFEg/exec"; 
  </script>

  <header class="main-header container-fluid p-0">
    <div class="header-overlay"></div>
    <div class="header-content d-flex align-items-center">
      <div class="me-4"><i class="material-icons" style="font-size: 4rem;">account_balance</i></div> 
      <div>
        <h1 class="m-0 fw-bold" style="text-shadow: 0 2px 4px rgba(0,0,0,0.3);">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h1>
        <div style="font-size: 1.1rem; opacity: 0.9; letter-spacing: 1px;">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</div>
      </div>
    </div>
  </header>

  <div class="container-fluid p-0 d-flex flex-grow-1 flex-column flex-md-row">
    
    <div class="sidebar col-md-3 col-lg-2 p-0">
      <h6 class="px-3 text-secondary fw-bold mt-3 mb-2" style="font-size: 0.85rem; letter-spacing: 1px;">MENU</h6>
      
      <a class="nav-link-main active" id="menu-home" onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <div id="sub-home" class="mb-2">
        <a class="nav-link-sub" onclick="scrollToId('sec-feedback')">‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô</a>
        <a class="nav-link-sub" onclick="scrollToId('sec-dash')">Dashboard</a>
      </div>
      
      <a class="nav-link-main" id="menu-docs" onclick="showPage('docs')">üìÇ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
      <a class="nav-link-main" id="menu-calendar" onclick="showPage('calendar')">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</a>
      <a class="nav-link-main" id="menu-qa" onclick="showPage('qa')">‚ùì ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö (Q&A)</a>
      
      <div class="mt-5 px-3 mb-4">
         <button id="adminBtn" class="btn btn-outline-secondary btn-sm w-100 py-2" onclick="loginToggle()">
           <i class="material-icons align-middle fs-6">lock</i> Admin Login
         </button>
      </div>
    </div>

    <div class="col-md-9 col-lg-10 bg-light p-4">
      
      <div id="page-home">
        
        <div id="section-video" class="content-section text-center">
          <h3 class="section-header">üì∫ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏Ç‡∏≠‡∏á‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
          <div class="ratio ratio-16x9 w-100 w-md-75 mx-auto shadow rounded overflow-hidden" style="max-width: 800px;">
            <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" allowfullscreen></iframe>
          </div>
        </div>

        <div id="sec-feedback" class="content-section text-center" style="background: #fff;">
          <h3 class="fw-bold mb-5 text-dark" style="letter-spacing: 1px;">üì¢ ‡∏£‡∏±‡∏ö‡∏ü‡∏±‡∏á‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h3>
          
          <div class="row justify-content-center">
            
            <div class="col-lg-9 mb-4">
              <div class="banner-btn bg-gradient-pink" onclick="openFormModal('general')" role="button">
                <div class="banner-icon"><i class="material-icons">assignment</i></div>
                <div class="banner-text">
                   <div class="banner-title">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
                   <div class="banner-desc">(‡∏£‡∏±‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏ï‡∏•‡∏≠‡∏î 24 ‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)</div>
                   <div class="banner-desc mt-2 badge bg-white text-danger fs-6">üìÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö: 1 ‡∏°.‡∏Ñ. 68 - 31 ‡∏ò.‡∏Ñ. 68</div>
                </div>
              </div>
            </div>

            <div class="col-lg-9 mb-3" id="specialBanner" style="display:none;">
              <div class="banner-btn bg-gradient-yellow" onclick="openFormModal('special')" role="button">
                <div class="banner-icon"><i class="material-icons">lightbulb</i></div>
                <div class="banner-text">
                   <div class="banner-title">‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢: ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 2030</div>
                   <div class="banner-desc">(‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï)</div>
                   <div class="banner-desc mt-2 badge bg-danger text-white fs-6">üìÖ ‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö: 1 ‡∏Å.‡∏û. 68 - 28 ‡∏Å.‡∏û. 68</div>
                </div>
              </div>
            </div>

            <div class="col-lg-9" id="specialBannerClosed" style="display:none;">
               <div class="alert alert-secondary d-flex align-items-center justify-content-center py-4">
                 <i class="material-icons me-2">block</i> 
                 <div><strong>‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢‡∏û‡∏¥‡πÄ‡∏®‡∏©</strong> ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß</div>
               </div>
            </div>

          </div>
        </div>

        <div id="sec-dash" class="content-section text-center">
          <h4 class="text-primary mb-4 fw-bold">üìä Dashboard ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</h4>
          <div class="p-5 border border-dashed rounded bg-light">
             <i class="material-icons fs-1 text-muted mb-3">bar_chart</i>
             <h5 class="text-muted">‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏™‡∏î‡∏á‡∏Å‡∏£‡∏≤‡∏ü‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h5>
             <small>‡∏£‡∏∞‡∏ö‡∏ö‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</small>
          </div>
        </div>
      </div>

      <div id="page-docs" style="display:none;">
        <div class="content-section">
          <h3 class="section-header">üìÇ ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Ç‡πâ‡∏≠‡∏á</h3>
          <div class="list-group list-group-flush">
            <a href="#" class="list-group-item list-group-item-action d-flex align-items-center py-4 px-3 border-bottom">
              <i class="material-icons fs-2 me-4 text-danger">picture_as_pdf</i>
              <div>
                <h5 class="mb-1 fw-bold text-dark">‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏â‡∏ö‡∏±‡∏ö‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô (PDF)</h5>
                <small class="text-muted">‡∏â‡∏ö‡∏±‡∏ö‡∏™‡∏°‡∏ö‡∏π‡∏£‡∏ì‡πå ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏õ‡∏µ‡∏á‡∏ö‡∏õ‡∏£‡∏∞‡∏°‡∏≤‡∏ì 2568 (‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï: 25 ‡∏°.‡∏Ñ. 68)</small>
              </div>
            </a>
            <a href="http://www.chiangmai.go.th" target="_blank" class="list-group-item list-group-item-action d-flex align-items-center py-4 px-3">
              <i class="material-icons fs-2 me-4 text-primary">language</i>
              <div>
                <h5 class="mb-1 fw-bold text-dark">‡πÄ‡∏ß‡πá‡∏ö‡πÑ‡∏ã‡∏ï‡πå‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</h5>
                <small class="text-muted">www.chiangmai.go.th</small>
              </div>
            </a>
          </div>
        </div>
      </div>

      <div id="page-calendar" style="display:none;">
        <div class="content-section border-0 bg-transparent p-0 mb-4 shadow-none">
          <h2 class="text-primary fw-bold"><i class="material-icons align-middle fs-2">calendar_month</i> ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h2>
          <p class="text-muted">‡∏£‡∏ß‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç ‡∏Å‡∏≤‡∏£‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏Ç‡∏≠‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</p>
        </div>

        <div id="adminPanel" class="content-section bg-warning-subtle mb-4 border-warning" style="display:none;">
          <h5 class="fw-bold text-dark"><i class="material-icons align-middle">admin_panel_settings</i> ‡πÅ‡∏ú‡∏á‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•</h5>
          <hr class="border-secondary opacity-25">
          
          <div class="form-check form-switch mb-4 bg-white p-3 rounded shadow-sm d-flex align-items-center justify-content-between">
             <div>
                <label class="form-check-label fw-bold text-dark" for="toggleSpecialForm">‡πÄ‡∏õ‡∏¥‡∏î‡∏£‡∏±‡∏ö‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô "‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏û‡∏¥‡πÄ‡∏®‡∏© (Banner ‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á)"</label>
                <div class="small text-muted">‡∏´‡∏≤‡∏Å‡∏õ‡∏¥‡∏î‡∏™‡∏ß‡∏¥‡∏ï‡∏ä‡πå‡∏ô‡∏µ‡πâ ‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ‡∏à‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏´‡πá‡∏ô‡∏õ‡∏∏‡πà‡∏°‡∏™‡∏µ‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏´‡∏ô‡πâ‡∏≤‡πÅ‡∏£‡∏Å</div>
             </div>
             <input class="form-check-input fs-4" type="checkbox" id="toggleSpecialForm" onchange="toggleSpecialForm()">
          </div>

          <h6 class="fw-bold mt-4 mb-3">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏•‡∏á‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô</h6>
          <form onsubmit="submitCalendar(event)">
            <input class="form-control mb-2" id="c_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° (‡πÄ‡∏ä‡πà‡∏ô ‡∏õ‡∏£‡∏∞‡∏ä‡∏∏‡∏° ‡∏Å‡∏£‡∏≠.)" required>
            <div class="row mb-2">
              <div class="col-md-5 mb-2"><label class="small text-muted">‡∏ß‡∏±‡∏ô‡πÄ‡∏£‡∏¥‡πà‡∏°</label><input type="date" class="form-control" id="c_start" required></div>
              <div class="col-md-5 mb-2"><label class="small text-muted">‡∏ß‡∏±‡∏ô‡∏à‡∏ö</label><input type="date" class="form-control" id="c_end"></div>
              <div class="col-md-2 mb-2"><label class="small text-muted">‡∏™‡∏µ‡πÅ‡∏ñ‡∏ö</label><input type="color" class="form-control form-control-color w-100" id="c_color" value="#0d6efd"></div>
            </div>
            <input class="form-control mb-2" id="c_desc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° (‡πÄ‡∏ß‡∏•‡∏≤, ‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà)">
            <input class="form-control mb-3" id="c_link" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£/‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)">
            <button class="btn btn-dark w-100 fw-bold"><i class="material-icons align-middle fs-6">save</i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</button>
          </form>
        </div>

        <div class="calendar-container">
          <div class="calendar-header">
            <button class="btn-nav" onclick="changeMonth(-1)"><i class="material-icons">chevron_left</i></button>
            <h4 id="monthDisplay" class="m-0 fw-bold">...</h4>
            <button class="btn-nav" onclick="changeMonth(1)"><i class="material-icons">chevron_right</i></button>
          </div>
          <div class="calendar-grid">
             <div class="day-name text-danger">‡∏≠‡∏≤.</div><div class="day-name">‡∏à.</div><div class="day-name">‡∏≠.</div>
             <div class="day-name">‡∏û.</div><div class="day-name">‡∏û‡∏§.</div><div class="day-name">‡∏®.</div><div class="day-name text-primary">‡∏™.</div>
          </div>
          <div class="calendar-grid" id="calBody">
             <div class="p-5 text-center w-100 text-muted" style="grid-column: span 7;">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...</div>
          </div>
        </div>
      </div>

      <div id="page-qa" style="display:none;">
        <div class="content-section">
          <h3 class="section-header">‚ùì ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö (Q&A)</h3>
          <p class="text-muted mb-4">‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏û‡∏ö‡∏ö‡πà‡∏≠‡∏¢‡πÄ‡∏Å‡∏µ‡πà‡∏¢‡∏ß‡∏Å‡∏±‡∏ö‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡πÅ‡∏•‡∏∞‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</p>
          
          <div class="accordion accordion-flush" id="accQA">
            <div class="accordion-item border rounded mb-3 shadow-sm">
              <h2 class="accordion-header"><button class="accordion-button fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#qa1">üìå ‡πÇ‡∏Ñ‡∏£‡∏á‡∏Å‡∏≤‡∏£‡∏ô‡∏µ‡πâ‡∏°‡∏µ‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏≠‡∏∞‡πÑ‡∏£?</button></h2>
              <div id="qa1" class="accordion-collapse collapse show"><div class="accordion-body text-muted bg-light">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡πÅ‡∏•‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏ä‡∏ô ‡∏ô‡∏≥‡πÑ‡∏õ‡∏™‡∏π‡πà‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏ó‡∏≥‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏õ‡∏£‡∏∞‡∏™‡∏¥‡∏ó‡∏ò‡∏¥‡∏†‡∏≤‡∏û‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏á‡∏à‡∏∏‡∏î ‡πÇ‡∏î‡∏¢‡πÄ‡∏ô‡πâ‡∏ô‡∏Å‡∏≤‡∏£‡∏°‡∏µ‡∏™‡πà‡∏ß‡∏ô‡∏£‡πà‡∏ß‡∏°‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏†‡∏≤‡∏Ñ‡∏™‡πà‡∏ß‡∏ô</div></div>
            </div>
            <div class="accordion-item border rounded mb-3 shadow-sm">
              <h2 class="accordion-header"><button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#qa2">üìÖ ‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏°‡∏µ‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏µ‡πà‡∏õ‡∏µ?</button></h2>
              <div id="qa2" class="accordion-collapse collapse"><div class="accordion-body text-muted bg-light">‡πÅ‡∏ú‡∏ô‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà‡∏â‡∏ö‡∏±‡∏ö‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô ‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏•‡∏∏‡∏°‡∏£‡∏∞‡∏¢‡∏∞‡πÄ‡∏ß‡∏•‡∏≤ 5 ‡∏õ‡∏µ (‡∏û.‡∏®. 2566 - 2570) ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ‡πÄ‡∏Å‡∏¥‡∏î‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏ó‡∏µ‡πà‡∏ï‡πà‡∏≠‡πÄ‡∏ô‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡∏∞‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô</div></div>
            </div>
            <div class="accordion-item border rounded mb-3 shadow-sm">
              <h2 class="accordion-header"><button class="accordion-button collapsed fw-bold" type="button" data-bs-toggle="collapse" data-bs-target="#qa3">üìû ‡∏´‡∏≤‡∏Å‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÑ‡∏´‡∏ô?</button></h2>
              <div id="qa3" class="accordion-collapse collapse"><div class="accordion-body text-muted bg-light">‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡πÑ‡∏î‡πâ‡∏ó‡∏µ‡πà‡πÄ‡∏ö‡∏≠‡∏£‡πå‡πÇ‡∏ó‡∏£‡∏®‡∏±‡∏û‡∏ó‡πå 053-112-703 ‡πÉ‡∏ô‡∏ß‡∏±‡∏ô‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏≤‡∏ä‡∏Å‡∏≤‡∏£</div></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <footer class="main-footer container-fluid p-0">
    <div class="row m-0">
      <div class="col-lg-4 mb-4 mb-lg-0">
        <h5 class="footer-title">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•<br>‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h5>
        <p class="mb-2 text-white-50">‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</p>
        <p class="small opacity-50">‡∏≠‡∏≤‡∏Ñ‡∏≤‡∏£‡∏≠‡∏≥‡∏ô‡∏ß‡∏¢‡∏Å‡∏≤‡∏£ ‡∏ä‡∏±‡πâ‡∏ô 3 ‡∏®‡∏≤‡∏•‡∏≤‡∏Å‡∏•‡∏≤‡∏á‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏ñ‡∏ô‡∏ô‡πÇ‡∏ä‡∏ï‡∏ô‡∏≤ <br>‡∏ï‡∏≥‡∏ö‡∏•‡∏ä‡πâ‡∏≤‡∏á‡πÄ‡∏ú‡∏∑‡∏≠‡∏Å ‡∏≠‡∏≥‡πÄ‡∏†‡∏≠‡πÄ‡∏°‡∏∑‡∏≠‡∏á‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà ‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 50300</p>
        <div class="admin-trigger" onclick="loginToggle()">¬© 2026 All Rights Reserved.</div>
      </div>
      <div class="col-lg-4 mb-4 mb-lg-0">
        <h5 class="footer-title">‡∏ä‡πà‡∏≠‡∏á‡∏ó‡∏≤‡∏á‡∏Å‡∏≤‡∏£‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</h5>
        <ul class="list-unstyled">
          <li class="mb-3 d-flex"><span class="me-2">üìû</span> <span>053-112-703</span></li>
          <li class="mb-3 d-flex"><span class="me-2">üìß</span> <span>plancm.700@gmail.com</span></li>
          <li class="mb-3 d-flex"><span class="me-2">üïí</span> <span>‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå - ‡∏®‡∏∏‡∏Å‡∏£‡πå (08.30 - 16.30 ‡∏ô.)</span></li>
          <li class="mb-3 d-flex"><span class="me-2">üåê</span> <a href="http://www.chiangmai.go.th" class="text-decoration-none text-white-50">www.chiangmai.go.th</a></li>
        </ul>
      </div>
      <div class="col-lg-4">
        <h5 class="footer-title">‡πÅ‡∏ú‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡∏±‡πâ‡∏á‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏á‡∏≤‡∏ô</h5>
        <div class="map-container mb-3" style="height: 200px; background: #333;">
          <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3777.073400030026!2d98.96962291538332!3d18.84364176510363!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x30da3a7e90960001%3A0x6a37890c4273030!2z4Lio4Liy4Lil4Liy4LiB4Lil4Liy4LiH4LiI4Lix4LiH4Lir4Lin4Lix4LiU4LmA4LiK4Li14Lii4LiH4LmD4Lir4Lih4LmI!5e0!3m2!1sth!2sth!4v1675240000000!5m2!1sth!2sth" width="100%" height="100%" style="border:0;" allowfullscreen="" loading="lazy"></iframe>
        </div>
      </div>
    </div>
  </footer>

  <div class="modal fade" id="formModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title fw-bold" id="formTitle">‡πÅ‡∏ö‡∏ö‡∏ü‡∏≠‡∏£‡πå‡∏°</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4">
          <form onsubmit="submitForm(event)">
            <input type="hidden" id="f_topic_type">
            <div class="mb-3">
               <label class="fw-bold form-label">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏• <span class="text-danger">*</span></label>
               <input class="form-control" id="f_name" required placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠‡∏à‡∏£‡∏¥‡∏á">
            </div>
            <div class="mb-3">
               <label class="fw-bold form-label">‡πÄ‡∏ö‡∏≠‡∏£‡πå‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠</label>
               <input class="form-control" id="f_contact" placeholder="‡πÄ‡∏ä‡πà‡∏ô 08x-xxxxxxx">
            </div>
            <div class="mb-3">
               <label class="fw-bold form-label">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î / ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏¥‡∏î‡πÄ‡∏´‡πá‡∏ô <span class="text-danger">*</span></label>
               <textarea class="form-control" id="f_detail" rows="5" required placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡πÄ‡∏™‡∏ô‡∏≠‡πÅ‡∏ô‡∏∞..."></textarea>
            </div>
            <div class="d-grid">
               <button class="btn btn-success py-2 fw-bold shadow-sm">üöÄ ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <div class="modal fade" id="eventDetailModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content border-0 shadow-lg" style="border-radius: 15px; overflow: hidden;">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title fw-bold" id="modalEventTitle">‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body p-4 bg-light">
          <div class="d-flex align-items-start mb-3">
            <div class="bg-white p-2 rounded-circle shadow-sm me-3"><i class="material-icons text-primary fs-4">event</i></div>
            <div>
              <small class="text-muted fw-bold text-uppercase" style="font-size: 0.75rem;">‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</small>
              <div id="modalEventDate" class="fw-bold text-dark fs-5"></div>
            </div>
          </div>
          <hr class="my-3 opacity-25">
          <div class="d-flex align-items-start mb-4">
            <div class="bg-white p-2 rounded-circle shadow-sm me-3"><i class="material-icons text-primary fs-4">info</i></div>
            <div>
              <small class="text-muted fw-bold text-uppercase" style="font-size: 0.75rem;">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</small>
              <div id="modalEventDesc" class="text-dark" style="white-space: pre-line;"></div>
            </div>
          </div>
          
          <a id="modalEventLink" href="#" target="_blank" class="btn btn-primary w-100 py-2 rounded-pill shadow-sm fw-bold">
            <i class="material-icons align-text-bottom fs-6 me-1">open_in_new</i> ‡πÄ‡∏õ‡∏¥‡∏î‡∏•‡∏¥‡∏á‡∏Å‡πå‡∏õ‡∏£‡∏∞‡∏ä‡∏≤‡∏™‡∏±‡∏°‡∏û‡∏±‡∏ô‡∏ò‡πå / ‡πÄ‡∏≠‡∏Å‡∏™‡∏≤‡∏£
          </a>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <script>
    let currentDate = new Date();
    let events = [];
    let isAdmin = false;
    let specialFormOpen = true;

    function initSystem() { 
      fetchEvents(); 
      checkSettings(); 
    }

    // --- Navigation System ---
    function showPage(id) {
      // Hide all
      ['home','docs','calendar','qa'].forEach(p => document.getElementById('page-'+p).style.display = 'none');
      // Show selected
      document.getElementById('page-'+id).style.display = 'block';
      
      // Update Menu Active State
      document.querySelectorAll('.nav-link-main').forEach(el => el.classList.remove('active'));
      document.getElementById('menu-'+id).classList.add('active');

      if(id === 'calendar') renderCalendar();
      window.scrollTo(0,0);
    }
    
    function scrollToId(id) {
       showPage('home');
       setTimeout(() => {
         document.getElementById(id).scrollIntoView({behavior: 'smooth', block: 'start'});
       }, 100);
    }

    // --- Data Fetching & Form Logic ---
    function checkSettings() {
       fetch(SCRIPT_URL + '?action=getSettings').then(r => r.json()).then(data => {
            specialFormOpen = (data.status === 'OPEN');
            updateBannerDisplay();
            if(document.getElementById('toggleSpecialForm')) {
               document.getElementById('toggleSpecialForm').checked = specialFormOpen;
            }
       });
    }

    function toggleSpecialForm() {
       let isChecked = document.getElementById('toggleSpecialForm').checked;
       let status = isChecked ? 'OPEN' : 'CLOSED';
       
       postData({ action: 'toggleForm', status: status }, () => {
          specialFormOpen = isChecked;
          updateBannerDisplay();
          const Toast = Swal.mixin({toast: true, position: 'top-end', showConfirmButton: false, timer: 3000});
          Toast.fire({icon: 'success', title: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢'});
       });
    }

    function updateBannerDisplay() {
       if (isAdmin) {
          document.getElementById('specialBanner').style.display = 'block';
          document.getElementById('specialBanner').style.opacity = specialFormOpen ? '1' : '0.5';
          document.getElementById('specialBannerClosed').style.display = 'none';
       } else {
          document.getElementById('specialBanner').style.display = specialFormOpen ? 'block' : 'none';
          document.getElementById('specialBannerClosed').style.display = specialFormOpen ? 'none' : 'block';
       }
    }

    var modalForm;
    function openFormModal(type) {
       modalForm = new bootstrap.Modal(document.getElementById('formModal'));
       let title = (type === 'general') ? '‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' : '‡πÄ‡∏™‡∏ô‡∏≠‡πÑ‡∏≠‡πÄ‡∏î‡∏µ‡∏¢: ‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà 2030';
       document.getElementById('formTitle').innerText = title;
       document.getElementById('f_topic_type').value = title;
       modalForm.show();
    }

    function submitForm(e) {
      e.preventDefault();
      let btn = e.target.querySelector('button');
      let oldText = btn.innerText;
      btn.disabled = true; btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•...';

      let data = { 
        action:'saveForm', 
        name: getVal('f_name'), 
        contact: getVal('f_contact'), 
        detail: getVal('f_detail'), 
        topic: getVal('f_topic_type') 
      };
      
      postData(data, () => { 
        Swal.fire('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• ‡∏ó‡∏≤‡∏á‡πÄ‡∏£‡∏≤‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß','success'); 
        document.forms[0].reset();
        modalForm.hide();
        btn.disabled = false; btn.innerText = oldText;
      });
    }

    // --- Calendar System ---
    function fetchEvents() { 
      fetch(SCRIPT_URL + '?action=getEvents')
      .then(r => r.json())
      .then(data => { events = data; renderCalendar(); })
      .catch(e => console.error("Error loading events:", e));
    }
    
    function renderCalendar() {
      const y = currentDate.getFullYear(), m = currentDate.getMonth();
      document.getElementById('monthDisplay').innerText = new Date(y, m).toLocaleDateString('th-TH', {month:'long', year:'numeric'});
      const firstDay = new Date(y, m, 1).getDay();
      const daysInMonth = new Date(y, m+1, 0).getDate();
      
      let html = '';
      for(let i=0; i<firstDay; i++) html += '<div class="day-cell bg-light"></div>';
      
      for(let d=1; d<=daysInMonth; d++) {
        let dateKey = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        let daysEvents = events.filter(e => dateKey >= e.startDate && dateKey <= e.endDate);
        
        let evHtml = daysEvents.map(e => 
          `<div class="event-badge" style="background:${e.color}" onclick="openEventDetail('${e.id}')">
             ${e.title} ${isAdmin ? `<span class="delete-btn" onclick="delEvent('${e.id}', event)">‚úï</span>` : ''}
           </div>`
        ).join('');
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ
        let today = new Date();
        let isToday = (d === today.getDate() && m === today.getMonth() && y === today.getFullYear()) ? 'today' : '';

        html += `<div class="day-cell ${isToday}"><div class="day-number">${d}</div>${evHtml}</div>`;
      }
      document.getElementById('calBody').innerHTML = html;
      
      // ‡πÅ‡∏™‡∏î‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏ö‡∏ñ‡πâ‡∏≤‡πÄ‡∏õ‡πá‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô
      if(isAdmin) document.querySelectorAll('.delete-btn').forEach(el => el.style.display = 'block');
    }

    function openEventDetail(id) {
      let ev = events.find(e => e.id === id);
      if(!ev) return;

      document.getElementById('modalEventTitle').innerText = ev.title;
      let dateRange = formatDateThai(ev.startDate);
      if(ev.startDate !== ev.endDate) dateRange += " - " + formatDateThai(ev.endDate);
      document.getElementById('modalEventDate').innerText = dateRange;
      document.getElementById('modalEventDesc').innerText = ev.desc ? ev.desc : "- ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏ï‡∏¥‡∏° -";
      
      let linkBtn = document.getElementById('modalEventLink');
      if(ev.link && ev.link.trim() !== "") { 
        linkBtn.href = ev.link; linkBtn.style.display = 'block'; 
      } else { 
        linkBtn.style.display = 'none'; 
      }
      
      new bootstrap.Modal(document.getElementById('eventDetailModal')).show();
    }

    function formatDateThai(dateStr) {
      if(!dateStr) return "";
      let d = new Date(dateStr);
      let months = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
      return `${d.getDate()} ${months[d.getMonth()]} ${d.getFullYear() + 543}`;
    }
    
    function changeMonth(n) { currentDate.setMonth(currentDate.getMonth()+n); renderCalendar(); }
    
    function submitCalendar(e) {
      e.preventDefault();
      let btn = e.target.querySelector('button');
      btn.disabled = true; btn.innerText = '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å...';

      let data = { 
        action:'saveCalendar', 
        title: getVal('c_name'), 
        startDate: getVal('c_start'), 
        endDate: getVal('c_end'), 
        color: getVal('c_color'), 
        desc: getVal('c_desc'), 
        link: getVal('c_link') 
      };
      
      postData(data, () => { 
        Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢‡πÅ‡∏•‡πâ‡∏ß','success'); 
        document.getElementById('calForm').reset();
        fetchEvents(); 
        btn.disabled = false; btn.innerHTML = '<i class="material-icons align-middle fs-6">save</i> ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°';
      });
    }
    
    function delEvent(id, e) {
      e.stopPropagation(); // ‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ‡∏Å‡∏î‡∏ó‡∏∞‡∏•‡∏∏‡πÑ‡∏õ‡πÄ‡∏õ‡∏¥‡∏î Modal
      Swal.fire({
        title: '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö?', text: "‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?", icon: 'warning', 
        showCancelButton: true, confirmButtonColor: '#d33', confirmButtonText: '‡∏•‡∏ö‡πÄ‡∏•‡∏¢', cancelButtonText: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å'
      }).then((result) => {
        if (result.isConfirmed) {
          postData({action:'deleteEvent', id: id}, () => { 
             Swal.fire('‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢', '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß', 'success'); 
             fetchEvents(); 
          });
        }
      });
    }

    // --- Admin System ---
    function loginToggle() {
      if(isAdmin) { 
        isAdmin = false; 
        document.getElementById('adminPanel').style.display='none'; 
        document.getElementById('adminBtn').innerHTML = '<i class="material-icons align-middle fs-6">lock</i> Admin Login'; 
        updateBannerDisplay();
        renderCalendar(); 
        Swal.fire({icon: 'success', title: '‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡πÅ‡∏•‡πâ‡∏ß', timer: 1500, showConfirmButton: false});
        return; 
      }
      
      Swal.fire({ title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•', input: 'password', confirmButtonText: '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' }).then(res => {
        if(!res.value) return;
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏Å‡∏±‡∏ö Server
        postData({action: 'login', password: res.value}, (data) => {
           if(data.status === 'SUCCESS') {
              isAdmin=true; 
              document.getElementById('adminPanel').style.display='block'; 
              document.getElementById('adminBtn').innerHTML = '<i class="material-icons align-middle fs-6">logout</i> ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö'; 
              updateBannerDisplay(); 
              renderCalendar(); 
              // ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡∏õ‡∏∏‡πà‡∏° Toggle ‡πÉ‡∏´‡πâ‡∏ï‡∏£‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏à‡∏£‡∏¥‡∏á
              if(document.getElementById('toggleSpecialForm')) document.getElementById('toggleSpecialForm').checked = specialFormOpen;
              
              Swal.fire({icon: 'success', title: '‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏ú‡∏π‡πâ‡∏î‡∏π‡πÅ‡∏•‡∏£‡∏∞‡∏ö‡∏ö', timer: 1500, showConfirmButton: false});
           } else {
              Swal.fire({icon: 'error', title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á'});
           }
        });
      });
    }

    function postData(data, callback) { 
       fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) })
       .then(r => r.json())
       .then(d => callback(d))
       .catch(e => console.error(e)); 
    }
    
    function getVal(id) { return document.getElementById(id).value; }
  </script>
</body>
</html>
