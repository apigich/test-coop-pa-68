<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  
  <style>
    /* CSS ‡πÄ‡∏î‡∏¥‡∏°‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì */
    body { font-family: 'Sarabun', sans-serif; background-color: #f0f2f5; margin: 0; display: flex; flex-direction: column; min-height: 100vh; font-size: 0.95rem; }
    .main-header { background: url('https://upload.wikimedia.org/wikipedia/commons/thumb/8/80/Doi_Suthep_02.jpg/1200px-Doi_Suthep_02.jpg') center/cover; color: white; padding: 60px 0; position: relative; }
    .header-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background: linear-gradient(90deg, rgba(13,110,253,0.9), rgba(0,50,133,0.7)); }
    .header-content { position: relative; z-index: 2; padding: 0 20px; }
    .sidebar { min-height: 100vh; background: white; border-right: 1px solid #ddd; padding-top: 20px; }
    .nav-link-main { padding: 10px 20px; color: #0d6efd; font-weight: bold; cursor: pointer; display: block; text-decoration: none; }
    .nav-link-main:hover, .nav-link-main.active { background: #e7f1ff; }
    .nav-link-sub { padding: 5px 20px 5px 40px; color: #666; cursor: pointer; display: block; text-decoration: none; font-size: 0.9rem; }
    .nav-link-sub:hover { color: #0d6efd; }
    .content-section { background: white; padding: 25px; border-radius: 10px; margin-bottom: 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); }
    .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); border: 1px solid #ddd; }
    .day-cell { min-height: 80px; border: 1px solid #eee; padding: 5px; background: white; }
    .event-badge { display: block; background: #0d6efd; color: white; font-size: 12px; padding: 2px 5px; margin-bottom: 2px; border-radius: 4px; cursor: pointer; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
    .main-footer { background: #1a1d20; color: #ccc; padding: 60px 20px; margin-top: auto; }
    .delete-btn { float: right; color: white; background: red; border-radius: 50%; width: 15px; height: 15px; text-align: center; line-height: 15px; font-size: 10px; cursor: pointer; display: none; }
  </style>
</head>
<body onload="initSystem()">

  <script>
    const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwGWDn2t6cPkNDJyuYN_RXvBfB_m7MM1gdHs4-QVKLhRWOhkDjbxeOQxoAc3ZKoJaZFEg/exec"; 
  </script>

  <header class="main-header">
    <div class="header-overlay"></div>
    <div class="header-content d-flex align-items-center">
      <i class="material-icons" style="font-size: 3.5rem; margin-right: 15px;">account_balance</i>
      <div>
        <h1 class="m-0 fw-bold" style="font-size: 1.5rem;">‡∏Å‡∏•‡∏∏‡πà‡∏°‡∏á‡∏≤‡∏ô‡∏¢‡∏∏‡∏ó‡∏ò‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î</h1>
        <small>‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡πÄ‡∏ä‡∏µ‡∏¢‡∏á‡πÉ‡∏´‡∏°‡πà</small>
      </div>
    </div>
  </header>

  <div class="container-fluid p-0 d-flex flex-grow-1">
    <div class="sidebar col-md-2 d-none d-md-block">
      <h5 class="px-3 text-secondary">‡πÄ‡∏°‡∏ô‡∏π‡∏´‡∏•‡∏±‡∏Å</h5>
      <a class="nav-link-main active" onclick="showPage('home')">üè† ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å</a>
      <a class="nav-link-sub" onclick="showPage('home'); setTimeout(()=>window.scrollTo(0,500),100)">- ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</a>
      <a class="nav-link-sub" onclick="showPage('home'); setTimeout(()=>window.scrollTo(0,1000),100)">- Dashboard</a>
      <a class="nav-link-main" onclick="showPage('calendar')">üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</a>
      <a class="nav-link-main" onclick="showPage('qa')">‚ùì Q&A</a>
    </div>

    <div class="col-md-10 col-12 bg-light p-4">
      
      <div id="page-home">
        <div class="content-section text-center">
          <h3>üì∫ ‡∏ß‡∏¥‡∏î‡∏µ‡πÇ‡∏≠‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</h3>
          <div class="ratio ratio-16x9 w-75 mx-auto"><iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ"></iframe></div>
        </div>
        
        <div class="content-section">
          <h3>üì¢ ‡πÅ‡∏à‡πâ‡∏á‡∏õ‡∏±‡∏ç‡∏´‡∏≤</h3>
          <form onsubmit="submitForm(event)">
            <div class="row mb-3">
              <div class="col"><input class="form-control" id="f_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠-‡∏™‡∏Å‡∏∏‡∏•" required></div>
              <div class="col"><input class="form-control" id="f_contact" placeholder="‡∏ï‡∏¥‡∏î‡∏ï‡πà‡∏≠"></div>
            </div>
            <textarea class="form-control mb-3" id="f_detail" rows="3" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î" required></textarea>
            <button class="btn btn-primary w-100">‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
          </form>
        </div>
      </div>

      <div id="page-calendar" style="display:none;">
        <div class="d-flex justify-content-between mb-3">
          <h3>üìÖ ‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h3>
          <button id="adminBtn" class="btn btn-outline-secondary btn-sm" onclick="loginToggle()">Admin Login</button>
        </div>

        <div id="adminPanel" class="content-section bg-warning-subtle" style="display:none;">
          <h5>‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</h5>
          <form onsubmit="submitCalendar(event)">
            <input class="form-control mb-2" id="c_name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°" required>
            <div class="row mb-2">
              <div class="col"><input type="date" class="form-control" id="c_start" required></div>
              <div class="col"><input type="date" class="form-control" id="c_end"></div>
              <div class="col-2"><input type="color" class="form-control" id="c_color" value="#0d6efd"></div>
            </div>
            <input class="form-control mb-2" id="c_desc" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î">
            <input class="form-control mb-2" id="c_link" placeholder="‡∏•‡∏¥‡∏á‡∏Å‡πå">
            <button class="btn btn-dark w-100">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
          </form>
        </div>

        <div class="calendar-container bg-white p-3 rounded shadow-sm">
          <div class="d-flex justify-content-between align-items-center mb-3">
            <button class="btn btn-light" onclick="changeMonth(-1)"><</button>
            <h4 id="monthDisplay" class="m-0">...</h4>
            <button class="btn btn-light" onclick="changeMonth(1)">></button>
          </div>
          <div class="calendar-grid" id="calBody">Loading...</div>
        </div>
      </div>

      <div id="page-qa" style="display:none;">
        <div class="content-section">
          <h3>‚ùì ‡∏ñ‡∏≤‡∏°-‡∏ï‡∏≠‡∏ö</h3>
          <div class="accordion" id="accQA">
            <div class="accordion-item">
              <h2 class="accordion-header"><button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#q1">‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏‡∏õ‡∏£‡∏∞‡∏™‡∏á‡∏Ñ‡πå?</button></h2>
              <div id="q1" class="accordion-collapse collapse show"><div class="accordion-body">‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏ß‡∏ö‡∏£‡∏ß‡∏°‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î...</div></div>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    let currentDate = new Date();
    let events = [];
    let isAdmin = false;

    function initSystem() { fetchEvents(); }

    function showPage(id) {
      ['home','calendar','qa'].forEach(p => document.getElementById('page-'+p).style.display = 'none');
      document.getElementById('page-'+id).style.display = 'block';
      if(id === 'calendar') renderCalendar();
    }

    function fetchEvents() {
      fetch(SCRIPT_URL + '?action=getEvents')
        .then(r => r.json())
        .then(data => { events = data; renderCalendar(); })
        .catch(e => console.error(e));
    }

    function renderCalendar() {
      const y = currentDate.getFullYear(), m = currentDate.getMonth();
      document.getElementById('monthDisplay').innerText = new Date(y, m).toLocaleDateString('th-TH', {month:'long', year:'numeric'});
      const firstDay = new Date(y, m, 1).getDay();
      const daysInMonth = new Date(y, m+1, 0).getDate();
      
      let html = '';
      for(let i=0; i<firstDay; i++) html += '<div class="day-cell bg-light"></div>';
      
      for(let d=1; d<=daysInMonth; d++) {
        let dateKey = `${y}-${String(m+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        let daysEvents = events.filter(e => dateKey >= e.startDate && dateKey <= e.endDate);
        let evHtml = daysEvents.map(e => 
          `<div class="event-badge" style="background:${e.color}" onclick="alert('${e.title}\\n${e.desc}')">
             ${e.title} ${isAdmin ? `<span class="delete-btn" onclick="delEvent('${e.id}', event)">x</span>` : ''}
           </div>`
        ).join('');
        html += `<div class="day-cell"><div class="fw-bold">${d}</div>${evHtml}</div>`;
      }
      document.getElementById('calBody').innerHTML = html;
    }

    function changeMonth(n) { currentDate.setMonth(currentDate.getMonth()+n); renderCalendar(); }

    function submitForm(e) {
      e.preventDefault();
      let data = { action:'saveForm', name: getVal('f_name'), contact: getVal('f_contact'), detail: getVal('f_detail'), topic: '‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ' };
      postData(data, () => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß','success'); document.forms[0].reset(); });
    }

    function submitCalendar(e) {
      e.preventDefault();
      let data = { 
        action:'saveCalendar', title: getVal('c_name'), startDate: getVal('c_start'), 
        endDate: getVal('c_end'), color: getVal('c_color'), desc: getVal('c_desc'), link: getVal('c_link') 
      };
      postData(data, () => { Swal.fire('‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à','‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡πâ‡∏ß','success'); fetchEvents(); });
    }

    function delEvent(id, e) {
      e.stopPropagation();
      if(!confirm('‡∏•‡∏ö‡∏ô‡∏∞?')) return;
      postData({action:'deleteEvent', id: id}, () => { fetchEvents(); });
    }

    function loginToggle() {
      if(isAdmin) { isAdmin = false; document.getElementById('adminPanel').style.display='none'; document.getElementById('adminBtn').innerText='Admin Login'; renderCalendar(); return; }
      Swal.fire({ title: '‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô', input: 'password' }).then(res => {
        if(res.value === 'admin1234') { isAdmin=true; document.getElementById('adminPanel').style.display='block'; document.getElementById('adminBtn').innerText='Logout'; renderCalendar(); }
        else Swal.fire('‡∏ú‡∏¥‡∏î‡∏Ñ‡∏£‡∏±‡∏ö');
      });
    }

    function postData(data, callback) {
      fetch(SCRIPT_URL, { method: 'POST', body: JSON.stringify(data) }) // ‡πÑ‡∏°‡πà‡πÉ‡∏ä‡πâ mode: no-cors ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÉ‡∏´‡πâ debug ‡πÑ‡∏î‡πâ‡∏á‡πà‡∏≤‡∏¢‡∏Ç‡∏∂‡πâ‡∏ô‡πÉ‡∏ô‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (‡πÅ‡∏ï‡πà‡πÉ‡∏ô GitHub ‡∏à‡∏£‡∏¥‡∏á ‡∏≠‡∏≤‡∏à‡∏ï‡πâ‡∏≠‡∏á‡πÉ‡∏ä‡πâ no-cors ‡∏ñ‡πâ‡∏≤‡∏ï‡∏¥‡∏î‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á redirect)
      .then(r => callback()); // ‡πÅ‡∏ö‡∏ö‡∏¢‡πà‡∏≠
    }
    
    function getVal(id) { return document.getElementById(id).value; }
  </script>
</body>
</html>
